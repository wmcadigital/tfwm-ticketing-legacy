!function(){"use strict";function e(e,t,i,n,o,r,a,l,s){const c=this;var u;function m(){s.innerWidth<890?(c.includeMobileTemplate=!0,c.includeDesktopTemplate=!1):(c.includeMobileTemplate=!1,c.includeDesktopTemplate=!0)}c.loadingText="Loading...",c.loadingStatus="loading",c.loadingArray="Loading...",c.loading=t(function(){c.loadingText=c.loadingArray[Math.round(Math.random()*(c.loadingArray.length-1))]},3500),c.ticketID=n.ticket,c.filterAccordions={},c.relatedTickets={},c.priceLevelsList={},c.toggleClick=function(e){c.filterAccordions[e]=!c.filterAccordions[e]},c.modalShown=!1,c.toggleModal=function(){c.modalShown=!c.modalShown},c.toggleModalBus=function(){c.modalShownBus=!c.modalShownBus},c.toggleModalTrain=function(){c.modalShownTrain=!c.modalShownTrain},c.toggleModalSwift=function(){c.modalShownSwift=!c.modalShownSwift},c.toggleModalGPay=function(){c.modalShownGpay=!c.modalShownGpay},c.widthView=m,c.operatorList=[],c.limit=4,c.deviceDetect=function(){c.deviceDetector=a,c.userAgent=a.raw.userAgent,c.userAgent.includes("SwiftOneApp")?c.oneApp=!0:c.oneApp=!1;c.userAgent.includes("android")?c.android=!0:c.android=!1},c.openFilters=function(){document.getElementById("filterOverlay").style.display="block"},c.closeFilters=function(){document.getElementById("filterOverlay").style.display="none"},c.date=new Date,c.gpay=!1,c.searchLocation=l.host(),"630001"!==c.ticketID&&"443"!==c.ticketID&&"382"!==c.ticketID&&"385"!==c.ticketID&&"383"!==c.ticketID&&"383002"!==c.ticketID&&"382001"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/63"),"650001"!==c.ticketID&&"379001"!==c.ticketID&&"442010"!==c.ticketID&&"442009"!==c.ticketID&&"442005"!==c.ticketID&&"442006"!==c.ticketID&&"442001"!==c.ticketID&&"442002"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/65"),"640001"!==c.ticketID&&"651"!==c.ticketID&&"664"!==c.ticketID&&"665"!==c.ticketID&&"439"!==c.ticketID&&"389"!==c.ticketID&&"393"!==c.ticketID&&"422"!==c.ticketID&&"427"!==c.ticketID&&"428"!==c.ticketID&&"418"!==c.ticketID&&"419"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/45"),"640002"===c.ticketID&&(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/48"),"656"!==c.ticketID&&"667"!==c.ticketID&&"668"!==c.ticketID&&"397"!==c.ticketID&&"424"!==c.ticketID&&"429"!==c.ticketID&&"433"!==c.ticketID&&"432"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/50"),"611"!==c.ticketID&&"658"!==c.ticketID&&"441"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/57"),"640003"===c.ticketID&&(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/652"),"660021"!==c.ticketID&&"660022"!==c.ticketID&&"660030"!==c.ticketID&&"660026"!==c.ticketID&&"660016"!==c.ticketID&&"553010"!==c.ticketID&&"553011"!==c.ticketID&&"553012"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/660029"),"874"!==c.ticketID&&"873"!==c.ticketID&&"384"!==c.ticketID&&"386"!==c.ticketID&&"878"!==c.ticketID&&"877"!==c.ticketID&&"445"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/64"),"676"!==c.ticketID&&"677"!==c.ticketID&&"442015"!==c.ticketID&&"865"!==c.ticketID&&"866"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/46"),"444"!==c.ticketID&&"604"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/630005"),"442014"!==c.ticketID&&"442011"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/58"),"602"===c.ticketID&&(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/?allowBus&passengerType=Student&timeBand=Longer%20than%20a%20month&limit=6&limitExact=6#sbmBtn"),"714"!==c.ticketID&&"718"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/630002"),"715"!==c.ticketID&&"719"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/630003"),"394"!==c.ticketID&&"395"!==c.ticketID&&"396"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/391"),"413"!==c.ticketID&&"426"!==c.ticketID&&"431"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/59"),"399"===c.ticketID&&(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/555"),"415"===c.ticketID&&(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/ticket/557"),"442010"!==c.ticketID&&"442009"!==c.ticketID&&"442005"!==c.ticketID&&"442006"!==c.ticketID&&"442001"!==c.ticketID&&"442002"!==c.ticketID||(s.location.href="https://wmcadigital.github.io/tfwm-ticketing-legacy//#/"),c.deviceDetect(),u=c.ticketID,e.getTicket(u).then(function(t){if(c.all=t,c.all.relatedTickets.length&&(c.related=[],angular.forEach(c.all.relatedTickets,function(t){e.getTicket(t.id).then(function(e){c.relatedTickets[t.id]=e,c.relatedList=c.relatedTickets[t.id],c.related.push(c.relatedList)}).catch(function(e){c.errorMessage="There was a problem loading ticket data. Please try again later.",c.loadingStatus="error",console.error(e)})},c.related)),c.all.documents.length&&e.getTerms(u).then(function(e){c.relatedTerms=e}).catch(function(e){c.errorMessage="There was a problem loading terms and conditions data. Please try again later.",c.loadingStatus="error",console.error(e)}),e.getOperators().then(function(e){c.operatorList=e}).catch(function(e){c.errorMessage="There was a problem loading operator data. Please try again later.",c.loadingStatus="error",console.error(e)}),window?.setTicketFinder?.name.includes("Unicard Desktop Production")&&!c.all.buyTicketUrl.includes("ticketing.networkwestmidlands.com")){const[e,t]=c.all.buyTicketUrl.split("?");c.all.buyTicketUrl="https://my.swiftcard.org.uk/ssp/swift/dnr_importBasket.jsp?"+t}if(window?.setTicketFinder?.name.includes("Unicard Desktop Test")&&!c.all.buyTicketUrl.includes("ticketing.cenapps.org.uk")){const[e,t]=c.all.buyTicketUrl.split("?");c.all.buyTicketUrl="https://natex-ssp.unicard-uk.com/ssp/swift/dnr_importBasket.jsp?"+t}if(c.all.buyTicketUrl&&c.all.buyTicketUrl.includes("matrixId")&&window?.setTicketFinder?.name.includes("Smart Citizen")){let e="";window?.setTicketFinder?.name.includes("Smart Citizen Mobile Production")?e="https://m-public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Desktop Production")?e="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Mobile Test")?e="https://m-public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Production")?e="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Test")||window?.setTicketFinder?.name.includes("Smart Citizen Desktop Test")?e="https://public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Dev")&&(e="https://public-tfwmdev.smartcitizen.net");const[t,i]=c.all.buyTicketUrl.split("?"),n=i.replace("https://","").replace(/[\[\]]/g,"").replace(/[{}]/g,"").replace(/:/g,"=").replace(/'/g,"");c.all.buyTicketUrl=e+"?"+n}c.backToSearch=i,c.stationFromNameZone="1",c.loadingStatus="success"}).catch(function(e){c.errorMessage="There was a problem loading ticket data. Please try again later.",c.loadingStatus="error",console.error(e)}),function(t){e.getTicketFull(t).then(function(e){c.full=e,c.priceLevels=e.priceLevels,c.gpay=!1,c.priceLevelsList=c.priceLevels.map(function(e){return!!e.type.includes("Google Pay")&&(c.gpay=!0,!0)})}).catch(function(e){c.errorMessage="There was a problem loading ticket data. Please try again later.",c.loadingStatus="error",console.error(e)})}(c.ticketID),c.modalShownBus=!1,c.modalShownTrain=!1,c.modalShown=!1,c.modalShownSwift=!1,c.modalShownGpay=!1,c.includeDesktopTemplate=!1,c.includeMobileTemplate=!1,m();angular.element(s).bind("resize",function(){m()})}function t(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}function i(){return function(e){return e?String(e).replace(/\n/gm,"<br><br>"):""}}angular.module("ticketingApp").controller("TicketDetailCtrl",e).filter("removeHTMLTags",t).filter("escapeFilter",i).directive("modalDialog",function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,i){e.dialogStyle={},i.width&&(e.dialogStyle.width=i.width),i.height&&(e.dialogStyle.height=i.height),i.modalclass&&(e.dialogStyle.class=i.modalclass),e.hideModal=function(){e.show=!1}},template:'<div ng-show="show" class="mod"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="overlay modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}).directive("tabs",function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(e){const t=e.panes=[];e.select=function(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(i){0===t.length&&e.select(i),t.push(i)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("pane",function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,t,i,n){n.addPane(e)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}).directive("tooltip",function(){return{restrict:"A",controller:["$scope",function(e){e.isShown=!1,this.showHover=function(){e.isShown=!0!==e.isShown}}],transclude:!0,link:function(e,t,i,n){e.copy=i.tooltipc,t.bind("click",function(){e.$apply(function(){n.showHover()})})},template:'<div ng-transclude></div><p class="field-help tooltip" ng-show="isShown"><span class="close modal__close"></span><span data-ng-bind-html="copy"></span></p>'}}),e.$inject=["ticketingService","$interval","getURL","$routeParams","$scope","$timeout","deviceDetector","$location","$window"],t.$inject=[],i.$inject=[]}(),function(){"use strict";function e(e,t){return function(i){console.log("Exception caught by $exceptionHandler:"),e.error(i),t.Sentry&&t.Sentry.captureException&&t.Sentry.captureException(i)}}function t(e,t,i,n,o,r,a,l,s,c,u,m){const d=this;let f,h,p,k=null,w=null;function S(){d.all=[],d.filteredTickets=[],d.origTickets=[],d.otherTickets=[],d.stationList=[],d.stationoocList=[],d.stationicList=[],d.swiftPaygIds=[],d.loadingStatus="",d.swiftPaygloadingStatus="",d.passValue="",d.orderBy="orderSequence",d.limit=parseInt(a.search().limit)||6,d.limitExact=parseInt(a.search().limitExact)||6,d.postJSON={allowBus:a.search().allowBus||null,allowMetro:a.search().allowMetro||null,allowTrain:a.search().allowTrain||null,passengerType:a.search().passengerType||"",timeBand:a.search().timeBand||"",brand:a.search().brand||null,stationNames:a.search().stationNames||null},d.stationFromName=null,d.stationToName=null,d.stationFromTitle=null,d.stationToTitle=null,d.stationFromNameOocZ5=null,d.stationToNameOocZ5=null,d.fromStationInfo=null,d.eligibilityDate=null,d.excludebusParameter=a.search().excludeBus||null,d.buyOnDirectDebitParameter=a.search().buyOnDirectDebit||null,d.buyOnDirectPurchaseParameter=a.search().buyOnDirectPurchase||null,d.buyOnSwiftParameter=a.search().buyOnSwift||null,d.hasOnlinePurchaseChannelParameter=a.search().hasOnlinePurchaseChannel||null,d.purchaseTicParameter=a.search().purchaseTic||null,d.purchaseRailStationParameter=a.search().purchaseRailStation||null,d.purchasePayzoneParameter=a.search().purchasePayzone||null,d.busTravelAreaParameter=a.search().busTravelArea||null,d.operatorParameter=a.search().operator||null,d.railZoneFromParameter=a.search().railZoneFrom||null,d.railZoneToParameter=a.search().railZoneTo||null,d.timePeriodAnytimeParameter=a.search().timePeriodAll||null,d.timePeriod1Parameter=a.search().timePeriod1||null,d.timePeriod2Parameter=a.search().timePeriod2||null,d.timePeriod3Parameter=a.search().timePeriod3||null,d.timePeriod4Parameter=a.search().timePeriod4||null,d.clearModes=y,d.postedJSON={},d.stationFromReq=!1,d.stationToReq=!1,d.stationToReqtwo=!1,d.stationFromOOCReq=!0,d.timePeriodAll=!0,d.fromZoneNumber=null,d.toZoneNumber=null}function g(e,t){const i=new Date(e);return i.setFullYear(T.getFullYear()-t),i}d.submit=N,d.clearFilter=function(){a.url("").replace(),S(),d.excludeBusCheck=function(){return!1},d.excludeTrainCheck=function(){return!1},d.excludeTramCheck=function(){return!1},d.buyOnDirectDebitCheck=function(){return!1},d.buyOnDirectPurchaseCheck=function(){return!1},d.buyOnSwiftCheck=function(){return!1},d.hasOnlinePurchaseChannelCheck=function(){return!1},d.purchaseTicCheck=function(){return!1},d.purchaseRailStationCheck=function(){return!1},d.purchasePayzoneCheck=function(){return!1},d.timePeriod1CheckAll=function(){return!1},d.timePeriod1Check=function(){return!1},d.timePeriod2Check=function(){return!1},d.timePeriod3Check=function(){return!1},d.timePeriod4Check=function(){return!1},l.set("url",""),d.postJSON.stationNames=[],D(),I(),B()},d.getStations=function(){s.getStations().then(function(e){let t,i,n,o,a,l,s,c,u;d.stationList=e,null!==d.stationFromName&&(t=d.stationFromName||null,i=d.stationToName||null,n=d.stationViaOneName||null,o=r("filter")(e,{name:t}),a=r("filter")(e,{name:i}),l=r("filter")(e,{name:n}),s=o[0],c=a[0],u=l[0],d.fromStationInfo=s,d.toStationInfo=c,d.ViaOneStationInfo=u,null!=d.fromStationInfo&&(d.fromZoneNumber=d.fromStationInfo.zone,d.toZoneNumber=d.toStationInfo.zone,null!=d.ViaOneStationInfo&&(d.ViaOneZoneNumber=d.ViaOneStationInfo.zone)))}).catch(function(e){d.errorMessage="There was a problem loading train station data. Please try again later.",d.loadingStatus="error",console.error(e)})},d.getoocStations=function(){s.getStations().then(function(e){const t=r("filter")(e,{outOfCounty:"true"});d.stationoocList=t}).catch(function(e){d.errorMessage="There was a problem loading train station data. Please try again later.",d.loadingStatus="error",console.error(e)})},d.geticStations=function(){s.getStations().then(function(e){const t=r("filter")(e,{outOfCounty:"false"});d.stationicList=t}).catch(function(e){d.errorMessage="There was a problem loading train station data. Please try again later.",d.loadingStatus="error",console.error(e)})},d.clearFromStation=D,d.clearToStation=I,d.clearViaOneStation=B,d.clearStation=function(){"[]"===a.search().stationNames&&D()},d.clearTime=function(){d.timePeriod1CheckAll=function(){return!1},d.timePeriod1Check=function(){return!1},d.timePeriod2Check=function(){return!1},d.timePeriod3Check=function(){return!1},d.timePeriod4Check=function(){return!1},d.timePeriodAll=!1,d.searchFilters.timePeriod1=!1,d.searchFilters.timePeriod2=!1,d.searchFilters.timePeriod3=!1,d.searchFilters.timePeriod4=!1,d.update()},d.checkTimeAll=function(){"yes"===d.timePeriodAll?(d.searchFilters.timePeriod1=!0,d.searchFilters.timePeriod2=!0,d.searchFilters.timePeriod3=!0,d.searchFilters.timePeriod4=!0,d.timePeriod1CheckAll=function(){return!0},d.timePeriod1Check=function(){return!1},d.timePeriod2Check=function(){return!1},d.timePeriod3Check=function(){return!1},d.timePeriod4Check=function(){return!1}):"no"===d.timePeriodAll&&(d.searchFilters.timePeriod1="",d.searchFilters.timePeriod2="",d.searchFilters.timePeriod3="",d.searchFilters.timePeriod4="")},d.checkTime=function(){d.timePeriodAll=!1,!1===d.timePeriodAll&&(d.timePeriod1CheckAll=function(){return!1})},d.getSwiftPAYG=J,d.updateGrid=F,d.update=function(){let e=d.all,t=d.exactMatch,i=d.otherResults;angular.forEach(d.searchFilters,function(e,t){(-1!==t.indexOf("allow")&&e||!1===e&&-1===t.indexOf("allow"))&&delete d.searchFilters[t],d.searchFilters.timePeriod1&&(d.searchFilters.timePeriod2=!1,d.searchFilters.timePeriod3=!1,d.searchFilters.timePeriod4=!1),d.searchFilters.timePeriod2&&(d.searchFilters.timePeriod1=!1,d.searchFilters.timePeriod3=!1,d.searchFilters.timePeriod4=!1),d.searchFilters.timePeriod3&&(d.searchFilters.timePeriod1=!1,d.searchFilters.timePeriod2=!1,d.searchFilters.timePeriod4=!1),d.searchFilters.timePeriod4&&(d.searchFilters.timePeriod1=!1,d.searchFilters.timePeriod2=!1,d.searchFilters.timePeriod3=!1),"yes"===d.timePeriodAll&&(d.searchFilters.timePeriod1=!0,d.searchFilters.timePeriod2=!0,d.searchFilters.timePeriod3=!0,d.searchFilters.timePeriod4=!0)}),e=r("filter")(e,d.searchFilters),t=r("filter")(t,d.searchFilters),i=r("filter")(i,d.searchFilters),d.filteredTickets=r("orderBy")(e,d.orderBy),d.origTickets=r("orderBy")(t,d.orderBy),d.otherTickets=r("orderBy")(i,d.orderBy),"orderSequence"===d.orderBy?d.origTickets.sort(function(e,t){return d.sortPop="yes",d.sortPlw="no",d.sortPhl="no",t.buyOnDirectDebit-e.buyOnDirectDebit}):"ticketCurrentAmount"===d.orderBy?d.origTickets.sort(function(e,t){return d.sortPop="no",d.sortPlw="yes",d.sortPhl="no",e.ticketCurrentAmount-t.ticketCurrentAmount}):"-ticketCurrentAmount"===d.orderBy&&d.origTickets.sort(function(e,t){return d.sortPop="no",d.sortPlw="no",d.sortPhl="yes",t.ticketCurrentAmount-e.ticketCurrentAmount});d.updateGrid()},d.loadMore=function(){d.limit+=6,a.search("limit",d.limit),d.updateGrid(),d.refreshOther()},d.loadMoreExact=function(){d.limitExact+=6,a.search("limitExact",d.limitExact),d.updateGrid(),d.refreshExact()},d.refreshExact=z,d.refreshOther=C,d.filterButtons={operator:[],operatorLength:0,busTravelArea:[],railZoneFrom:[],railZoneTo:[]},d.toggleFilter=function(e){d.filterButtons[e]=!d.filterButtons[e]},d.swiftPAYG=Z,d.swiftABT=v,d.ntrainOOC=function(){d.passValue=d.postJSON.brand,"ntrain - Out of County"===d.passValue?(d.isHideCheck=!d.isHideCheck,d.stationFromReqOOC=!0,d.stationToReqOOC=!0,d.stationFromName=null,d.stationToName=null,d.stationViaOneName=null):(d.stationFromReqOOC=!1,d.stationToReqOOC=!1,a.search().stationNames&&(f=a.search().stationNames,h=f.toString(),p=h.split(","),d.stationFromName=p[0],d.stationToName=p[1],d.stationViaOneName=p[2]))},d.toggleModalFilter=function(){d.modalShownFilter=!d.modalShownFilter},d.searchLocation=a.host(),d.deviceDetect=function(){d.deviceDetector=m,d.userAgent=m.raw.userAgent,d.userAgent.includes("SwiftOneApp")?d.oneApp=!0:d.oneApp=!1;d.userAgent.includes("android")?d.android=!0:d.android=!1;"android"===d.deviceDetector.os||"ios"===d.deviceDetector.os?d.isMobile=!0:d.isMobile=!1},d.selectPass=function(){d.passValue=d.postJSON.brand,""===d.passValue&&(console.log("select pass"),d.clearFilter())},S(),d.slug="testing789",console.log("v2.16.3");const b=new Date,O=b.getFullYear(),T=new Date(`${O}-09-01T00:00:00.000Z`);let P=g(T,18);function N(e){let t,l,c,u,m,f,h,p,S,g,b;d.loadingStatus="loading",angular.copy(d.postJSON,d.postedJSON),k=o(function(){d.errorMessage="The ticket search is taking too long. Retrying...",d.loadingStatus="timeout",window.Sentry&&window.Sentry.captureMessage&&window.Sentry.captureMessage("Ticket search API call is slow or unresponsive",{level:"warning",extra:{postJSON:d.postJSON,url:a.absUrl()}}),N(e)},1e4),a.search({allowBus:d.postedJSON.allowBus,allowTrain:d.postedJSON.allowTrain,allowMetro:d.postedJSON.allowMetro,passengerType:d.postedJSON.passengerType,timeBand:d.postedJSON.timeBand,brand:d.postedJSON.brand,stationNames:d.postedJSON.stationNames,buyOnDirectDebit:d.buyOnDirectDebitParameter,buyOnDirectPurchase:d.buyOnDirectPurchaseParameter,buyOnSwift:d.buyOnSwiftParameter,hasOnlinePurchaseChannel:d.hasOnlinePurchaseChannelParameter,purchaseTic:d.purchaseTicParameter,purchaseRailStation:d.purchaseRailStationParameter,purchasePayzone:d.purchasePayzoneParameter,busTravelArea:d.busTravelAreaParameter,operator:d.operatorParameter,railZoneFrom:d.railZoneFromParameter,railZoneTo:d.railZoneToParameter,timePeriodAll:d.timePeriodAnytimeParameter,timePeriod1:d.timePeriod1Parameter,timePeriod2:d.timePeriod2Parameter,timePeriod3:d.timePeriod3Parameter,timePeriod4:d.timePeriod4Parameter,limit:d.limit,limitExact:d.limitExact,excludeBus:d.excludebusParameter}),d.searchFilters={},d.origFilters={},s.ticketSearch(e).then(function(e){for(o.cancel(k),d.all=e,d.original=e,angular.forEach(d.all,function(e){if(-1===d.filterButtons.operator.indexOf(e.operator)&&d.filterButtons.operator.push(e.operator),-1===d.filterButtons.busTravelArea.indexOf(e.busTravelArea)&&d.filterButtons.busTravelArea.push(e.busTravelArea),-1===d.filterButtons.railZoneFrom.indexOf(e.railZoneFrom)&&d.filterButtons.railZoneFrom.push(e.railZoneFrom),-1===d.filterButtons.railZoneTo.indexOf(e.railZoneTo)&&d.filterButtons.railZoneTo.push(e.railZoneTo),window?.setTicketFinder?.name.includes("TfWM Ticket Finder")&&!e.buyTicketUrl.includes("ticketing.networkwestmidlands.com")){const[t,i]=e.buyTicketUrl.split("?");e.buyTicketUrl="https://my.swiftcard.org.uk/ssp/swift/dnr_importBasket.jsp?"+i}if(window?.setTicketFinder?.name.includes("Unicard Desktop Test")&&!e.buyTicketUrl.includes("ticketing.cenapps.org.uk")){const[t,i]=e.buyTicketUrl.split("?");e.buyTicketUrl="https://natex-ssp.unicard-uk.com/ssp/swift/dnr_importBasket.jsp?"+i}if(e.swiftCurrentAmount&&window?.setTicketFinder?.name.includes("Smart Citizen")){console.log("payg detected");let t="";window?.setTicketFinder?.name.includes("Smart Citizen Mobile Production")?t="https://m-public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Desktop Production")?t="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Mobile Test")?t="https://m-public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Production")?t="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Test")||window?.setTicketFinder?.name.includes("Smart Citizen Desktop Test")?t="https://public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Dev")&&(t="https://public-tfwmdev.smartcitizen.net");const i=t+"/?matrixId=AAC001";console.log(i),e.buyTicketUrl=t+"/?matrixId=AAC001"}if(e.buyTicketUrl.includes("matrixId")&&window?.setTicketFinder?.name.includes("Smart Citizen")){let t="";window?.setTicketFinder?.name.includes("Smart Citizen Mobile Production")?t="https://m-public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Desktop Production")?t="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Mobile Test")?t="https://m-public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Production")?t="https://public-tfwmlive.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Test")||window?.setTicketFinder?.name.includes("Smart Citizen Desktop Test")?t="https://public-tfwmtest.smartcitizen.net":window?.setTicketFinder?.name.includes("Smart Citizen Dev")&&(t="https://public-tfwmdev.smartcitizen.net");const[i,n]=e.buyTicketUrl.split("?"),o=n.replace("https://","").replace(/[\[\]]/g,"").replace(/[{}]/g,"").replace(/:/g,"=").replace(/'/g,"");e.buyTicketUrl=t+"?"+o}return e.buyTicketUrl}),t=d.postedJSON.allowBus||!1,l=d.postedJSON.allowTrain||!1,c=d.postedJSON.allowMetro||!1,!0!==d.postJSON.allowTrain&&"nnetwork"!==d.postJSON.brand&&"ntrain"!==d.postJSON.brand||(null!=d.fromStationInfoZone?d.fromZoneNumber=d.fromStationInfoZone:null!=d.fromStationInfo?d.fromZoneNumber=d.fromStationInfo.zone:d.fromZoneNumber=null,null!=d.toStationInfoZone?d.toZoneNumber=d.toStationInfoZone:null!=d.toStationInfo?d.toZoneNumber=d.toStationInfo.zone:d.toZoneNumber=null,"1"===d.fromZoneNumber?d.ffromzone=1:"2"===d.fromZoneNumber?d.ffromzone=2:"3"===d.fromZoneNumber?d.ffromzone=3:"4"===d.fromZoneNumber?d.ffromzone=4:"5"===d.fromZoneNumber?d.ffromzone=5:d.ffromzone=null,"1"===d.toZoneNumber?d.ftozone=1:"2"===d.toZoneNumber?d.ftozone=2:"3"===d.toZoneNumber?d.ftozone=3:"4"===d.toZoneNumber?d.ftozone=4:"5"===d.toZoneNumber?d.ftozone=5:d.ftozone=null,"1"===d.ViaOneZoneNumber?d.fViaOnezone=1:"2"===d.ViaOneZoneNumber?d.fViaOnezone=2:"3"===d.ViaOneZoneNumber?d.fViaOnezone=3:"4"===d.ViaOneZoneNumber?d.fViaOnezone=4:"5"===d.ViaOneZoneNumber?d.fViaOnezone=5:d.fViaOnezone=null,null!=d.ViaOneZoneNumber&&(d.ViaOneZoneNumber<d.fromZoneNumber?d.ffromzone=d.ViaOneZoneNumber:d.ViaOneZoneNumber>d.toZoneNumber&&(d.ftozone=d.ViaOneZoneNumber))),!0===d.postJSON.allowTrain?(d.exactMatch=[],null!==d.fromZoneNumber&&null!==d.toZoneNumber?d.ffromzone<d.ftozone?d.exactMatch=r("filter")(e,{allowBus:t,allowTrain:l,allowMetro:c,railZoneFrom:d.ffromzone,railZoneTo:d.ftozone}):d.ffromzone>d.ftozone?d.exactMatch=r("filter")(e,{allowBus:t,allowTrain:l,allowMetro:c,railZoneFrom:d.ftozone,railZoneTo:d.ffromzone}):d.ffromzone===d.ftozone&&(d.exactMatch=r("filter")(e,{allowBus:t,allowTrain:l,allowMetro:c,railZoneFrom:1,railZoneTo:d.ftozone})):d.exactMatch=r("filter")(e,{allowBus:t,allowTrain:l,allowMetro:c})):"nnetwork"===d.postJSON.brand||"ntrain"===d.postJSON.brand?(d.exactMatch=[],null!==d.fromZoneNumber&&null!==d.toZoneNumber?d.ffromzone<d.ftozone?d.exactMatch=r("filter")(e,{railZoneFrom:d.ffromzone,railZoneTo:d.ftozone}):d.ffromzone>d.ftozone?d.exactMatch=r("filter")(e,{railZoneFrom:d.ftozone,railZoneTo:d.ffromzone}):d.ffromzone===d.ftozone&&(d.exactMatch=r("filter")(e,{railZoneFrom:1,railZoneTo:d.ftozone})):d.exactMatch=r("filter")(e,{})):(d.postedJSON.stationNames=null,d.exactMatch=r("filter")(e,{allowBus:t,allowTrain:l,allowMetro:c})),g=d.all,b=d.exactMatch,u=0;u<b.length;u+=1)for(f=g.length,m=0;m<f;m+=1)b[u]===g[m]&&(g=g.slice(0,m).concat(g.slice(m+1,f)));d.otherResults=g,h=d.postedJSON.allowBus,p=d.postedJSON.allowTrain,S=d.postedJSON.allowMetro,(null!==h||null!==h&&null!==p||null!==h&&null!==S||null!==p&&null!==S)&&d.toggleFilter("mode"),null!==h&&null!==p&&null!==S&&d.toggleFilter("payment"),d.update(),d.loadingStatus="success",d.errorMessage="",a.hash("sbmBtn"),n()}).catch(function(t){d.errorMessage="There was a problem loading ticket data. Please try again later.",d.loadingStatus="error",function(e){w||(w=i(function(){N(e)},5e3,2))}(e),console.error(t)})}function F(){o(function(){o(function(){let e,t,i,n,o,r,a;d.filteredTickets.length&&(a={passengerType:d.postedJSON.passengerType,timeBand:d.postedJSON.timeBand,brand:d.postedJSON.brand,stationNames:d.postedJSON.stationNames,busTravelArea:d.searchFilters.busTravelArea,operator:d.searchFilters.operator,buyOnDirectDebit:d.searchFilters.buyOnDirectDebit,buyOnDirectPurchase:d.searchFilters.buyOnDirectPurchase||null,buyOnSwift:d.searchFilters.buyOnSwift,hasOnlinePurchaseChannel:d.searchFilters.hasOnlinePurchaseChannel,purchaseTic:d.searchFilters.purchaseTic,purchaseRailStation:d.searchFilters.purchaseRailStation,purchasePayzone:d.searchFilters.purchasePayzone,railZoneFrom:d.searchFilters.railZoneFrom,railZoneTo:d.searchFilters.railZoneTo,limit:d.limit,limitExact:d.limitExact,excludeBus:d.searchFilters.allowBus},t=u(a),d.postedJSON.allowBus&&(i="allowBus"),d.postedJSON.allowTrain&&(n="allowTrain"),d.postedJSON.allowMetro&&(o="allowMetro"),r=!0===d.searchFilters.timePeriod1?"&timePeriod1=true&timePeriod2=false&timePeriod3=false&timePeriod4=false":!0===d.searchFilters.timePeriod2?"&timePeriod1=false&timePeriod2=true&timePeriod3=false&timePeriod4=false":!0===d.searchFilters.timePeriod3?"&timePeriod1=false&timePeriod2=false&timePeriod3=true&timePeriod4=false":!0===d.searchFilters.timePeriod4?"&timePeriod1=false&timePeriod2=false&timePeriod3=false&timePeriod4=true":!0===d.timePeriodAll?"&timePeriodAll=true":"",!d.postedJSON.allowBus||d.postedJSON.allowTrain||d.postedJSON.allowMetro||(e="/?"+i+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus&&d.postedJSON.allowTrain&&!d.postedJSON.allowMetro&&(e="/?"+i+"&"+n+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus&&!d.postedJSON.allowTrain&&d.postedJSON.allowMetro&&(e="/?"+i+"&"+o+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus||!d.postedJSON.allowTrain||d.postedJSON.allowMetro||(e="/?"+n+"&"+t+r,l.set("url",e)),!d.postedJSON.allowBus&&d.postedJSON.allowTrain&&d.postedJSON.allowMetro&&(e="/?"+n+"&"+o+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus||d.postedJSON.allowTrain||!d.postedJSON.allowMetro||(e="/?"+o+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus&&d.postedJSON.allowTrain&&d.postedJSON.allowMetro&&(e="/?"+i+"&"+n+"&"+o+"&"+t+r,l.set("url",e)),d.postedJSON.allowBus||d.postedJSON.allowTrain||d.postedJSON.allowMetro||(e="/?"+t+r,l.set("url",e)))},0,!1)},0,!1)}function y(){d.postJSON.allowBus=null,d.postJSON.allowTrain=null,d.postJSON.allowMetro=null}function D(){t.$broadcast("angucomplete-alt:clearInput","stationFrom"),t.$broadcast("angucomplete-alt:clearInput","stationFromOOC"),d.stationFromName=null,d.postJSON.stationNames[0]=null,d.stationFromReq=!1,d.stationFromNameOocZ5=null,d.fromStationInfoZone=null,d.fromStationText=null}function I(){t.$broadcast("angucomplete-alt:clearInput","stationTo"),t.$broadcast("angucomplete-alt:clearInput","stationTo2"),t.$broadcast("angucomplete-alt:clearInput","stationTo3"),d.stationToName="",d.postJSON.stationNames[1]=null,d.stationToReq=!1,d.stationToNameOocZ5=null,d.toStationInfoZone=null,d.toStationText=""}function B(){t.$broadcast("angucomplete-alt:clearInput","stationViaOne"),d.stationViaOneName=null,d.viaOneStationText=null,d.stationViaOneName=null,d.postJSON.stationNames=[]}function z(){angular.element(document).ready(function(){o(function(){c.origTicketResults.refresh()},0)})}function C(){angular.element(document).ready(function(){o(function(){c.ticketResults.refresh()},0)})}function Z(){d.passValue=d.postJSON.brand,"Swift PAYG"===d.passValue?(d.isHideCheck=!d.isHideCheck,d.postJSON.passengerType=null,d.postJSON.timeBand=null,d.postJSON.stationNames=[]):"nbus"!==d.passValue&&"National Express"!==d.passValue&&"Diamond Bus"!==d.passValue&&"Stagecoach"!==d.passValue&&"Swift PAYG"!==d.passValue&&"West Midlands Metro"!==d.passValue||(d.postJSON.stationNames=[])}function v(){d.passValue=d.postJSON.brand,"Swift Go"===d.passValue?(d.isHideCheck=!d.isHideCheck,d.postJSON.timeBand=null,d.postJSON.stationNames=[]):"nbus"!==d.passValue&&"National Express"!==d.passValue&&"Diamond Bus"!==d.passValue&&"Stagecoach"!==d.passValue&&"Swift PAYG"!==d.passValue&&"West Midlands Metro"!==d.passValue||(d.postJSON.stationNames=[])}function J(){s.getSwiftSearch().then(function(e){d.swiftPaygIds=[],angular.forEach(e,function(e){e.swiftCurrentAmount&&d.swiftPaygIds.push(e)})}).catch(function(e){d.errorMessage="There was a problem loading Swift data. Please try again later.",d.loadingStatus="error",console.error(e)})}P=g(T,b>T?18:19),d.eligibilityDate=P.getFullYear(),a.search().allowBus||a.search().allowMetro||a.search().allowTrain||a.search().brand&&a.search().passengerType&&a.search().timeBand||a.search().busTravelArea||a.search().operator||a.search().stationNames||a.search().brand?(d.clearStation(),a.search().stationNames&&!0===d.postJSON.allowTrain||"nnetwork"===d.postJSON.brand||"ntrain"===d.postJSON.brand?a.search().stationNames&&(f=a.search().stationNames,h=f.toString(),p=h.split(","),d.stationFromName=p[0],d.stationToName=p[1],d.stationViaOneName=p[2]):(d.stationFromName=null,d.stationToName=null),d.getStations(),N(d.postJSON)):a.url("").replace(),d.showDetails=!1,"Swift PAYG"===a.search().brand&&(J(),Z()),"Swift Go"===a.search().brand&&v(),d.deviceDetect(),F.$inject=["$timeout","angularGridInstance"],d.fromEmpty="none",d.fromStationInputChanged=function(e){d.fromStationText=e},d.fromfocusState="None",d.fromFocusIn=function(){d.fromfocusState="In"},d.fromFocusOut=function(){d.fromfocusState="Out",null!=d.stationToName&&(d.stationFromReq=!0),null!=d.fromStationText&&null==d.stationFromName&&(d.stationFromReq=!0)},d.stationFromReq=!1,d.stationFromReqOOC=!0,d.stationFrom=function(e){e?(d.postJSON.stationNames=[],d.stationFromName=e.originalObject.name,d.postJSON.stationNames[0]=e.originalObject.name,d.stationFromNameZone=e.originalObject.zone,d.stationFromNameOoc=e.originalObject.outOfCounty,d.stationFromNameOocZ5=e.originalObject.zone5InCounty,d.fromZoneNumber=e.originalObject.zone,d.fromStationInfoZone=e.originalObject.zone,d.stationFromReq=!1,d.fromEmpty=!0):(d.stationFromName=null,d.postJSON.stationNames[0]=null,d.stationFromReq=!1,d.fromEmpty=!1)},d.toEmpty="none",d.toStationInputChanged=function(e){d.toStationText=e},d.tofocusState="None",d.toFocusIn=function(){d.tofocusState="In",null!=d.stationFromName&&(d.stationToReq=!0)},d.toFocusOut=function(){d.tofocusState="Out",null!=d.stationFromName&&(d.stationToReq=!0),null!==d.toStationText&&null===d.stationToName&&(d.stationToReq=!0)},d.stationToReq=!1,d.stationToReqOOC=!0,d.stationTo=function(e){e?(d.stationToName=e.title,d.postJSON.stationNames[1]=e.originalObject.name,d.stationToTitle=e.originalObject.name,d.stationToNameZone=e.originalObject.zone,d.stationToNameOoc=e.originalObject.outOfCounty,d.stationToNameOocZ5=e.originalObject.zone5InCounty,d.toZoneNumber=e.originalObject.zone,d.toStationInfoZone=e.originalObject.zone,d.stationToReq=!1,d.toEmpty=!0):(d.stationToName=null,d.postJSON.stationNames[1]=null,d.stationToTitle=null,d.toEmpty=!1)},d.viaOneStationInputChanged=function(e){d.viaOneStationText=e},d.viaOnefocusState="None",d.stationViaOneFocusIn=function(){d.viaOnefocusState="In"},d.stationViaOneFocusOut=function(){d.viaOnefocusState="Out",null!=d.stationViaOneName&&(d.stationviaOneReq=!0),null==d.viaOneStationText&&null!=d.stationViaOneName||(d.stationViaOneReq=!0,d.stationToReq=!0,d.stationFromReq=!0)},d.stationViaOne=function(e){e&&(d.stationViaOneName=e.originalObject.name,d.postJSON.stationNames[2]=e.originalObject.name,d.stationViaOneTitle=e.originalObject.name,d.stationViaOneNameZone=e.originalObject.zone,d.stationViaOneNameOoc=e.originalObject.outOfCounty,d.stationViaOneNameOocZ5=e.originalObject.zone5InCounty,d.ViaOneZoneNumber=e.originalObject.zone,d.ViaOneStationInfoZone=e.originalObject.zone)},null!=d.stationViaOneName&&(d.stationVia=!0),d.excludebusParameter&&(d.filterButtons.mode=!d.filterButtons.mode,d.searchFilters.allowBus=!1,d.excludeBusCheck=function(){return!0}),d.buyOnDirectDebitParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.buyOnDirectDebit=!0,d.buyOnDirectDebitCheck=function(){return!0}),d.buyOnDirectPurchaseParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.buyOnDirectPurchase=!0,d.buyOnDirectPurchaseCheck=function(){return!0}),d.buyOnSwiftParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.buyOnSwift=!0,d.buyOnSwiftCheck=function(){return!0}),d.hasOnlinePurchaseChannelParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.hasOnlinePurchaseChannel=!0,d.hasOnlinePurchaseChannelCheck=function(){return!0}),d.purchaseTicParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.purchaseTic=!0,d.purchaseTicCheck=function(){return!0}),d.purchaseRailStationParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.purchaseRailStation=!0,d.purchaseRailStationCheck=function(){return!0}),d.purchasePayzoneParameter&&(d.filterButtons.payment=!d.filterButtons.payment,d.searchFilters.purchasePayzone=!0,d.purchasePayzoneCheck=function(){return!0}),d.busTravelAreaParameter&&(d.filterButtons.busTravelAreaBtn=!d.filterButtons.busTravelAreaBtn,d.searchFilters.busTravelArea=d.busTravelAreaParameter),d.operatorParameter&&(d.filterButtons.operatorBtn=!d.filterButtons.operatorBtn,d.searchFilters.operator=d.operatorParameter),d.railZoneFromParameter&&(d.filterButtons.railZoneBtn=!d.filterButtons.railZoneBtn,d.searchFilters.railZoneFrom=d.railZoneFromParameter),d.railZoneToParameter&&(d.filterButtons.railZoneBtn=!d.filterButtons.railZoneBtn,d.searchFilters.railZoneTo=d.railZoneToParameter),"true"===a.search().timePeriodAll&&(d.searchFilters.timeLimited=!1,d.searchFilters.timePeriod1="",d.filterButtons.time=!d.filterButtons.time,d.timePeriodAll=!0,d.timePeriod1CheckAll=function(){return!0}),"true"===a.search().timePeriod1&&(d.filterButtons.time=!d.filterButtons.time,d.searchFilters.timePeriod1=!0,d.timePeriod1Check=function(){return!0}),"true"===a.search().timePeriod2&&(d.filterButtons.time=!d.filterButtons.time,d.searchFilters.timePeriod2=!0,d.timePeriod2Check=function(){return!0}),"true"===a.search().timePeriod3&&(d.filterButtons.time=!d.filterButtons.time,d.searchFilters.timePeriod3=!0,d.timePeriod3Check=function(){return!0}),"true"===a.search().timePeriod4&&(d.filterButtons.time=!d.filterButtons.time,d.searchFilters.timePeriod4=!0,d.timePeriod4Check=function(){return!0}),d.hideModalFilter=function(){d.modalShownFilter=!d.modalShownFilter},d.modalShownFilter=!1,z.$inject=["$timeout","angularGridInstance"],C.$inject=["$timeout","angularGridInstance"],d.date=new Date}function i(){let e;return function(t,i,n){if(void 0!==t)return e=new RegExp(i,"g"),t.replace(e,n)}}angular.module("ticketingApp").factory("$exceptionHandler",e).controller("TicketingSearchCtrl",t).filter("replace",i),e.$inject=["$log","$window"],t.$inject=["ngAuthSettings","$scope","$interval","$anchorScroll","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance","$httpParamSerializer","deviceDetector"],i.$inject=[]}();
//# sourceMappingURL=controller.min.js.map
