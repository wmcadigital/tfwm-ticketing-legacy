!function(){"use strict";function e(e,t){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(r,l,i){e(function(){r.$last&&t.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",[]).controller("TicketingSearchCtrl",["$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(e,t,r,l,i,a){var n=this;function o(){n.all=[],n.filteredTickets=[],n.loadingStatus="",n.orderBy="TicketCurrentAmount",n.limit=parseInt(r.search().limit)||6,n.postJSON={AllowBus:r.search().AllowBus||null,AllowMetro:r.search().AllowMetro||null,AllowTrain:r.search().AllowTrain||null,PassengerType:r.search().PassengerType||"",TimeBand:r.search().TimeBand||""},n.postedJSON={}}n.submit=s,n.clearFilter=function(){r.url("").replace(),o()},n.updateGrid=function(){e(function(){e(function(){n.filteredTickets.length&&(a.ticketResults.refresh(),l.set("url",r.url()))},82,!1)},82,!1)},n.update=function(){var e=n.all;console.log(n.searchFilters),angular.forEach(n.searchFilters,function(e,t){(-1!==t.indexOf("Allow")&&e||0==e&&-1===t.indexOf("Allow"))&&delete n.searchFilters[t]}),e=t("filter")(e,n.searchFilters),n.filteredTickets=t("orderBy")(e,n.orderBy),console.log(n.filteredTickets),console.log(n.searchFilters),n.updateGrid()},n.loadMore=function(){n.limit+=6,r.search("limit",n.limit),n.updateGrid()},n.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},n.toggleFilter=function(e){n.filterButtons[e]=!n.filterButtons[e]},o(),(r.search().AllowBus||r.search().AllowMetro||r.search().AllowTrain)&&r.search().PassengerType&&r.search().TimeBand?s(n.postJSON):r.url("").replace();function s(e){n.loadingStatus="loading",angular.copy(n.postJSON,n.postedJSON),r.search({AllowBus:n.postedJSON.AllowBus,AllowTrain:n.postedJSON.AllowTrain,AllowMetro:n.postedJSON.AllowMetro,PassengerType:n.postedJSON.PassengerType,TimeBand:n.postedJSON.TimeBand,limit:n.limit}),n.searchFilters={},console.log("this is posted"),console.log(n.postedJSON),i.ticketSearch(e).then(function(e){n.all=e,angular.forEach(n.all,function(e){-1==n.filterButtons.Operator.indexOf(e.Operator)&&n.filterButtons.Operator.push(e.Operator),-1==n.filterButtons.BusTravelArea.indexOf(e.BusTravelArea)&&n.filterButtons.BusTravelArea.push(e.BusTravelArea),-1==n.filterButtons.RailZoneFrom.indexOf(e.RailZoneFrom)&&n.filterButtons.RailZoneFrom.push(e.RailZoneFrom),-1==n.filterButtons.RailZoneTo.indexOf(e.RailZoneTo)&&n.filterButtons.RailZoneTo.push(e.RailZoneTo)}),n.update(),n.loadingStatus="success"})}}]).filter("removeHTMLTags",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,r){return angular.forEach({},function(t,r){console.log(r,t),console.log(e[r])}),angular.forEach(t,function(e){}),[]}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",e]).controller("TicketDetailCtrl",["ticketingService","$routeParams",function(e,t){var r=this;r.loadingStatus="Loading",r.ticketID=t.ticket,r.filterAccordions={},r.relatedTickets={},r.toggleClick=function(e){r.filterAccordions[e]=!r.filterAccordions[e]},l=r.ticketID,e.getTicket(l).then(function(t){r.all=t,console.log(t),r.all.RelatedTickets.length?angular.forEach(r.all.RelatedTickets,function(t){e.getSimpleTicket(t.Id).then(function(e){r.relatedTickets[t.Id]=e,console.log(r.relatedTickets),r.loadingStatus="Success"})}):r.loadingStatus="Success"});var l}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",[function(){return{templateUrl:"partials/detail/related-product.html",restrict:"E"}}])}();