!function(){"use strict";angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(t,e,a,o,n,i,l){var s=this;function r(){s.all=[],s.filteredTickets=[],s.stationList=[],s.stationoocList=[],s.stationicList=[],s.swiftPaygTickets=[],s.loadingStatus="",s.passValue="",s.orderBy="ticketCurrentAmount",s.limit=parseInt(o.search().limit)||6,s.postJSON={allowBus:o.search().allowBus||null,allowMetro:o.search().allowMetro||null,allowTrain:o.search().allowTrain||null,passengerType:o.search().passengerType||"",timeBand:o.search().timeBand||"",brand:o.search().brand||null,stationNames:o.search().stationNames||[[]]},s.clearModes=u,s.postedJSON={}}s.submit=c,s.clearFilter=function(){o.url("").replace(),r(),t.stationFromName=null,t.stationToName=null,t.stationFromTitle=null,t.stationToTitle=null},s.getStations=function(){i.getStations().then(function(t){console.log(t),s.stationList=t})},s.getoocStations=function(){i.getStations().then(function(t){var e=a("filter")(t,{OutOfCounty:"true"});s.stationoocList=e})},s.geticStations=function(){i.getStations().then(function(t){var e=a("filter")(t,{OutOfCounty:"false"});s.stationicList=e})},s.clearFromStation=function(){t.$broadcast("angucomplete-alt:clearInput","stationFrom"),t.stationFromName=null,s.postJSON.stationNames=[[]]},s.clearToStation=function(){t.$broadcast("angucomplete-alt:clearInput","stationTo"),t.stationToName=null,s.postJSON.stationNames=[[]]},s.getSwiftPAYG=p,s.updateGrid=function(){e(function(){e(function(){s.filteredTickets.length&&(l.ticketResults.refresh(),n.set("url",o.url()))},82,!1)},82,!1)},s.update=function(){var t=s.all;console.log(s.searchFilters),angular.forEach(s.searchFilters,function(t,e){(-1!==e.indexOf("allow")&&t||0==t&&-1===e.indexOf("allow"))&&delete s.searchFilters[e]}),t=a("filter")(t,s.searchFilters),s.filteredTickets=a("orderBy")(t,s.orderBy),console.log("Fitered Tickets:"),console.log(s.filteredTickets),console.log("Search Filters:"),console.log(s.searchFilters),s.updateGrid()},s.loadMore=function(){s.limit+=6,o.search("limit",s.limit),s.updateGrid()},s.filterButtons={operator:[],operatorLength:0,busTravelArea:[],railZoneFrom:[],railZoneTo:[]},s.toggleFilter=function(t){s.filterButtons[t]=!s.filterButtons[t]},s.swiftPAYG=d,s.ntrainOOC=function(){s.passValue=s.postJSON.brand,"ntrain - Out of County"==s.passValue&&(s.isHideCheck=!s.isHideCheck)},r(),o.search().allowBus||o.search().allowMetro||o.search().allowTrain||o.search().brand&&o.search().passengerType&&o.search().timeBand||o.search().stationNames||o.search().brand?c(s.postJSON):o.url("").replace();"Swift PAYG"==o.search().brand&&(p(),d());function c(e){s.loadingStatus="loading",angular.copy(s.postJSON,s.postedJSON),o.search({allowBus:s.postedJSON.allowBus,allowTrain:s.postedJSON.allowTrain,allowMetro:s.postedJSON.allowMetro,passengerType:s.postedJSON.passengerType,timeBand:s.postedJSON.timeBand,brand:s.postedJSON.brand,stationNames:s.postedJSON.stationNames,limit:s.limit}),s.searchFilters={},console.log("this is posted"),console.log(s.postedJSON),i.ticketSearch(e).then(function(e){s.all=e,console.log("ticket search"),console.log(e),angular.forEach(s.all,function(t){-1==s.filterButtons.operator.indexOf(t.operator)&&s.filterButtons.operator.push(t.operator),-1==s.filterButtons.busTravelArea.indexOf(t.busTravelArea)&&s.filterButtons.busTravelArea.push(t.busTravelArea),-1==s.filterButtons.railZoneFrom.indexOf(t.railZoneFrom)&&s.filterButtons.railZoneFrom.push(t.railZoneFrom),-1==s.filterButtons.railZoneTo.indexOf(t.railZoneTo)&&s.filterButtons.railZoneTo.push(t.railZoneTo)});var a=o.search().stationNames,n=a.toString(),i=n.split(",");t.stationFromName=i[0],t.stationToName=i[1],s.update(),s.loadingStatus="success"})}function u(){s.postJSON.allowBus=null,s.postJSON.allowTrain=null,s.postJSON.allowMetro=null}function d(){s.passValue=s.postJSON.brand,"Swift PAYG"==s.passValue?(s.isHideCheck=!s.isHideCheck,s.postJSON.passengerType=null,s.postJSON.timeBand=null,s.postJSON.stationNames=[]):"nbus"!=s.passValue&&"National Express"!=s.passValue&&"Diamond Bus"!=s.passValue&&"Stagecoach"!=s.passValue&&"Swift PAYG"!=s.passValue&&"West Midlands Metro"!=s.passValue||(s.postJSON.stationNames=[[]])}function p(){i.getSwiftSearch().then(function(t){s.swiftPaygTickets=t,console.log("swift search"),console.log(t)})}t.stationFrom=function(e){e?(t.stationFromName=e.originalObject.name,s.postJSON.stationNames[0]=e.originalObject.name,t.stationFromTitle=e.originalObject.name,t.stationFromNameZone=e.originalObject.zone,t.stationFromNameOoc=e.originalObject.outOfCounty,t.stationFromNameOocZ5=e.originalObject.zone5InCounty,t.stationFromNameOocZ5&&(s.postJSON.brand="ntrain",s.postJSON.allowBus=null,s.postJSON.allowMetro=null)):(t.stationFromName=null,s.postJSON.stationNames[0]=[[]],t.stationFromTitle=null)},t.stationTo=function(e){e?(t.stationToName=e.originalObject.name,s.postJSON.stationNames[1]=e.originalObject.name,t.stationToTitle=e.originalObject.name,t.stationToNameZone=e.originalObject.zone,t.stationToNameOoc=e.originalObject.outOfCounty,t.stationToNameOocZ5=e.originalObject.zone5InCounty,t.stationToNameOocZ5&&(s.postJSON.brand="ntrain",s.postJSON.allowBus=null,s.postJSON.allowMetro=null)):(t.stationToName=null,s.postJSON.stationNames[1]=[[]],t.stationToTitle=null)}}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,e){return angular.forEach({},function(t,e){}),angular.forEach(t,function(t){}),[]}}]).filter("escapeFilter",[function(){return function(t){return t?String(t).replace(/\n/gm,"<br><br>"):""}}]).filter("replace",[function(){return function(t,e,a){if(void 0!==t){var o=new RegExp(e,"g");return t.replace(o,a)}}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",function(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(a,o,n){t(function(){a.$last&&e.ticketResults.refresh()},0)}}}]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(t,e,a,o){var n=this;n.loadingText="Loading...",n.loadingStatus="Loading",n.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],n.loading=e(function(){n.loadingText=n.loadingArray[Math.round(Math.random()*(n.loadingArray.length-1))]},3500),n.ticketID=o.ticket,n.filterAccordions={},n.relatedTickets={},n.toggleClick=function(t){n.filterAccordions[t]=!n.filterAccordions[t]},n.modalShown=!1,n.toggleModal=function(){n.modalShown=!n.modalShown},n.operatorList=[],n.checkStations=function(){console.log("hello"+sessionStorage.getItem(savedData))},n.limit=4,i=n.ticketID,t.getTicket(i).then(function(e){n.all=e,console.log(e),n.all.relatedTickets.length?angular.forEach(n.all.relatedTickets,function(e){t.getSimpleTicket(e.id).then(function(t){n.relatedTickets[e.id]=t,console.log(n.relatedTickets[e.id]),n.loadingStatus="Success"})}):n.loadingStatus="Success",n.all.documents.length?t.getTerms(i).then(function(t){n.relatedTerms=t,n.loadingStatus="Success"}):n.loadingStatus="Success",t.getOperators().then(function(t){n.operatorList=t,console.log(t),n.loadingStatus="Success"}),n.backToSearch=a,console.log(n.backToSearch)});var i}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",["$timeout","angularGridInstance",function(t,e){return{templateUrl:"partials/detail/related-product.html",restrict:"E",link:function(a,o,n){t(function(){a.$last&&e.alternativeResults.refresh()},0)}}}]).directive("operators",[function(){return{templateUrl:"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(t,e,a){t.dialogStyle={},a.width&&(t.dialogStyle.width=a.width),a.height&&(t.dialogStyle.height=a.height),a.class&&(t.dialogStyle.class=a.class),t.hideModal=function(){t.show=!1}},template:'<div ng-show="show"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="ng-modal-dialog boxin modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(t){var e=t.panes=[];t.select=function(t){angular.forEach(e,function(t){t.selected=!1}),t.selected=!0},this.addPane=function(a){0==e.length&&t.select(a),e.push(a)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(t,e,a,o){o.addPane(t)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}]).directive("tooltip",[function(){return{restrict:"A",controller:function(t,e){t.isShown=!1,this.showHover=function(){t.isShown=1!=t.isShown}},transclude:!0,link:function(t,e,a,o){t.copy=a.tooltipc,e.bind("click",function(){t.$apply(function(){o.showHover()})})},template:'<div ng-transclude></div><p class="field-help tooltip" ng-show="isShown"><span data-ng-bind-html="copy"></span></p>'}}])}();