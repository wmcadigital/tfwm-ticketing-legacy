!function(){"use strict";function t(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(r,i,l){t(function(){r.$last&&e.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",[]).controller("TicketingSearchCtrl",["$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(t,e,r,i,l,n){var a=this;function o(){a.all=[],a.filteredTickets=[],a.loadingStatus="",a.orderBy="TicketCurrentAmount",a.limit=parseInt(r.search().limit)||6,a.postJSON={AllowBus:null,AllowMetro:null,AllowTrain:null,PassengerType:"",Timeband:""},a.postedJSON={}}a.submit=function(t){a.loadingStatus="loading",angular.copy(a.postJSON,a.postedJSON),a.searchFilters={},console.log("this is posted"),console.log(a.postedJSON),l.ticketSearch(t).then(function(t){a.all=t,angular.forEach(a.all,function(t){-1==a.filterButtons.Operator.indexOf(t.Operator)&&a.filterButtons.Operator.push(t.Operator),-1==a.filterButtons.BusTravelArea.indexOf(t.BusTravelArea)&&a.filterButtons.BusTravelArea.push(t.BusTravelArea),-1==a.filterButtons.RailZoneFrom.indexOf(t.RailZoneFrom)&&a.filterButtons.RailZoneFrom.push(t.RailZoneFrom),-1==a.filterButtons.RailZoneTo.indexOf(t.RailZoneTo)&&a.filterButtons.RailZoneTo.push(t.RailZoneTo)}),a.update(),a.loadingStatus="success"})},a.clearFilter=function(){r.url("").replace(),o()},a.updateGrid=function(){t(function(){t(function(){a.filteredTickets.length&&(n.ticketResults.refresh(),i.set("url",r.url()))},82,!1)},82,!1)},a.update=function(){var t=a.all;console.log(a.searchFilters),angular.forEach(a.searchFilters,function(t,e){(-1!==e.indexOf("Allow")&&t||0==t&&-1===e.indexOf("Allow"))&&delete a.searchFilters[e]}),t=e("filter")(t,a.searchFilters),a.filteredTickets=e("orderBy")(t,a.orderBy),console.log(a.filteredTickets),console.log(a.searchFilters),a.updateGrid()},a.loadMore=function(){a.limit+=6,r.search("limit",a.limit),a.updateGrid()},a.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},a.toggleFilter=function(t){a.filterButtons[t]=!a.filterButtons[t]},o()}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(e,r){return angular.forEach({},function(e,r){console.log(r,e),console.log(t[r])}),angular.forEach(e,function(t){}),[]}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",t]).controller("TicketDetailCtrl",["ticketingService","$routeParams",function(t,e){var r=this;r.ticketID=e.ticket,r.filterAccordions={},r.relatedTickets={},r.toggleClick=function(t){r.filterAccordions[t]=!r.filterAccordions[t]},i=r.ticketID,t.getTicket(i).then(function(e){r.all=e,console.log(e),r.all.RelatedTickets.length&&angular.forEach(r.all.RelatedTickets,function(e){t.getSimpleTicket(e.Id).then(function(t){r.relatedTickets[e.Id]=t,console.log(r.relatedTickets)})})});var i}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",[function(){return{templateUrl:"partials/detail/related-product.html",restrict:"E"}}])}();