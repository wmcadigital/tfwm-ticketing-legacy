!function(){"use strict";function e(e,t){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(l,i,r){e(function(){l.$last&&t.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(e,t,l,i,r,o,n){var a=this;function s(){a.all=[],a.filteredTickets=[],a.stationList=[],a.loadingStatus="",a.orderBy="TicketCurrentAmount",a.limit=parseInt(i.search().limit)||6,a.postJSON={AllowBus:i.search().AllowBus||null,AllowMetro:i.search().AllowMetro||null,AllowTrain:i.search().AllowTrain||null,PassengerType:i.search().PassengerType||"",TimeBand:i.search().TimeBand||"",Brand:i.search().Brand||null,StationNames:[]},a.clearModes=u,a.postedJSON={}}a.submit=c,a.clearFilter=function(){i.url("").replace(),s()},a.getStations=function(){o.getStations().then(function(e){a.stationList=e})},a.updateGrid=function(){t(function(){t(function(){a.filteredTickets.length&&(n.ticketResults.refresh(),r.set("url",i.url()))},82,!1)},82,!1)},a.update=function(){var e=a.all;console.log(a.searchFilters),angular.forEach(a.searchFilters,function(e,t){(-1!==t.indexOf("Allow")&&e||0==e&&-1===t.indexOf("Allow"))&&delete a.searchFilters[t]}),e=l("filter")(e,a.searchFilters),a.filteredTickets=l("orderBy")(e,a.orderBy),console.log(a.filteredTickets),console.log(a.searchFilters),a.updateGrid()},a.loadMore=function(){a.limit+=6,i.search("limit",a.limit),a.updateGrid()},a.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},a.toggleFilter=function(e){a.filterButtons[e]=!a.filterButtons[e]},s(),i.search().AllowBus||i.search().AllowMetro||i.search().AllowTrain||i.search().Brand&&i.search().PassengerType&&i.search().TimeBand||i.search().StationNames?c(a.postJSON):i.url("").replace();function c(e){a.loadingStatus="loading",angular.copy(a.postJSON,a.postedJSON),i.search({AllowBus:a.postedJSON.AllowBus,AllowTrain:a.postedJSON.AllowTrain,AllowMetro:a.postedJSON.AllowMetro,PassengerType:a.postedJSON.PassengerType,TimeBand:a.postedJSON.TimeBand,Brand:a.postedJSON.Brand,StationNames:[a.postJSON.StationNames],limit:a.limit}),a.searchFilters={},console.log("this is posted"),console.log(a.postedJSON),o.ticketSearch(e).then(function(e){a.all=e,angular.forEach(a.all,function(e){-1==a.filterButtons.Operator.indexOf(e.Operator)&&a.filterButtons.Operator.push(e.Operator),-1==a.filterButtons.BusTravelArea.indexOf(e.BusTravelArea)&&a.filterButtons.BusTravelArea.push(e.BusTravelArea),-1==a.filterButtons.RailZoneFrom.indexOf(e.RailZoneFrom)&&a.filterButtons.RailZoneFrom.push(e.RailZoneFrom),-1==a.filterButtons.RailZoneTo.indexOf(e.RailZoneTo)&&a.filterButtons.RailZoneTo.push(e.RailZoneTo)}),a.update(),a.loadingStatus="success"})}function u(){a.postJSON.AllowBus=null,a.postJSON.AllowTrain=null,a.postJSON.AllowMetro=null,a.postJSON.StationNames=null}e.stationFrom=function(e){e&&(console.log(e),a.postJSON.StationNames[0]=e.originalObject.Name)},e.stationTo=function(e){e&&(console.log(e),a.postJSON.StationNames[1]=e.originalObject.Name)}}]).filter("removeHTMLTags",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,l){return angular.forEach({},function(t,l){console.log(l,t),console.log(e[l])}),angular.forEach(t,function(e){}),[]}}]).filter("escapeFilter",[function(){return function(e){return e=e.replace(/\n/g,"<br><br>")}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",e]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(e,t,l,i){var r=this;r.loadingText="Loading...",r.loadingStatus="Loading",r.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],r.loading=t(function(){r.loadingText=r.loadingArray[Math.round(Math.random()*(r.loadingArray.length-1))]},3500),r.ticketID=i.ticket,r.filterAccordions={},r.relatedTickets={},r.toggleClick=function(e){r.filterAccordions[e]=!r.filterAccordions[e]},r.modalShown=!1,r.toggleModal=function(){console.log("Toggle Model"),r.modalShown=!r.modalShown},o=r.ticketID,e.getTicket(o).then(function(t){r.all=t,console.log(t),r.all.RelatedTickets.length?angular.forEach(r.all.RelatedTickets,function(t){e.getSimpleTicket(t.Id).then(function(e){r.relatedTickets[t.Id]=e,console.log(r.relatedTickets),r.loadingStatus="Success"})}):r.loadingStatus="Success",r.all.Documents.length?e.getTerms(o).then(function(e){r.relatedTerms=e,r.loadingStatus="Success"}):r.loadingStatus="Success",r.backToSearch=l,console.log(r.backToSearch)});var o}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",[function(){return{templateUrl:"partials/detail/related-product.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,l){e.dialogStyle={},l.width&&(e.dialogStyle.width=l.width),l.height&&(e.dialogStyle.height=l.height),e.hideModal=function(){e.show=!1}},template:"<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay' ng-click='hideModal()'></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}])}();