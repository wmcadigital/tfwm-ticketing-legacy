!function(){"use strict";angular.module("ticketingApp.Controller",["angucomplete-alt","angularGrid"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance","$httpParamSerializer",function(e,t,o,a,r,i,n,l){var s=this;function c(){s.all=[],s.filteredTickets=[],s.origTickets=[],s.otherTickets=[],s.stationList=[],s.stationoocList=[],s.stationicList=[],s.swiftPaygTickets=[],s.loadingStatus="",s.passValue="",s.orderBy="orderSequence",s.limit=parseInt(a.search().limit)||6,s.limitExact=parseInt(a.search().limitExact)||6,s.postJSON={allowBus:a.search().allowBus||null,allowMetro:a.search().allowMetro||null,allowTrain:a.search().allowTrain||null,passengerType:a.search().passengerType||"",timeBand:a.search().timeBand||"",brand:a.search().brand||null,stationNames:a.search().stationNames||[[]]},s.stationFromName=null,s.stationToName=null,s.stationFromTitle=null,s.stationToTitle=null,s.stationFromNameOocZ5=null,s.stationToNameOocZ5=null,s.fromStationInfo=null,e.buyOnDirectDebitParameter=a.search().buyOnDirectDebit||null,e.buyOnDirectPurchaseParameter=a.search().buyOnDirectPurchase||null,e.buyOnSwiftParameter=a.search().buyOnSwift||null,e.hasOnlinePurchaseChannelParameter=a.search().hasOnlinePurchaseChannel||null,e.purchaseTicParameter=a.search().purchaseTic||null,e.purchaseRailStationParameter=a.search().purchaseRailStation||null,e.purchasePayzoneParameter=a.search().purchasePayzone||null,e.busTravelAreaParameter=a.search().busTravelArea||null,e.operatorParameter=a.search().operator||null,e.railZoneFromParameter=a.search().railZoneFrom||null,e.railZoneToParameter=a.search().railZoneTo||null,e.timePeriodAnytimeParameter=a.search().timePeriodAll||null,e.timePeriod1Parameter=a.search().timePeriod1||null,e.timePeriod2Parameter=a.search().timePeriod2||null,e.timePeriod3Parameter=a.search().timePeriod3||null,e.timePeriod4Parameter=a.search().timePeriod4||null,s.clearModes=p,s.postedJSON={},e.stationFromReq=!1,e.stationToReq=!1,e.stationToReqtwo=!1,e.stationFromOOCReq=!0,e.timePeriodAll=!0,s.fromZoneNumber=null,s.toZoneNumber=null}if(e.assetPath=assetPath,e.ticketUrl=ticketUrl,s.submit=d,s.clearFilter=function(){a.url("").replace(),c(),e.buyOnDirectDebitCheck=function(){return!1},e.buyOnDirectPurchaseCheck=function(){return!1},e.buyOnSwiftCheck=function(){return!1},e.hasOnlinePurchaseChannelCheck=function(){return!1},e.purchaseTicCheck=function(){return!1},e.purchaseRailStationCheck=function(){return!1},e.purchasePayzoneCheck=function(){return!1},e.timePeriod1CheckAll=function(){return!1},e.timePeriod1Check=function(){return!1},e.timePeriod2Check=function(){return!1},e.timePeriod3Check=function(){return!1},e.timePeriod4Check=function(){return!1},r.set("url",""),O(),S(),P()},s.getStations=function(){i.getStations().then(function(e){if(s.stationList=e,null!==s.stationFromName){var t=s.stationFromName||null,a=s.stationToName||null,r=s.stationViaOneName||null,i=o("filter")(e,{name:t}),n=o("filter")(e,{name:a}),l=o("filter")(e,{name:r}),c=i[0],u=n[0],m=l[0];s.fromStationInfo=c,s.toStationInfo=u,s.ViaOneStationInfo=m,null!=s.fromStationInfo&&(s.fromZoneNumber=s.fromStationInfo.zone,s.toZoneNumber=s.toStationInfo.zone,null!=s.ViaOneStationInfo&&(s.ViaOneZoneNumber=s.ViaOneStationInfo.zone))}})},s.getoocStations=function(){i.getStations().then(function(e){var t=o("filter")(e,{outOfCounty:"true"});s.stationoocList=t})},s.geticStations=function(){i.getStations().then(function(e){var t=o("filter")(e,{outOfCounty:"false"});s.stationicList=t})},s.clearFromStation=O,s.clearToStation=S,s.clearViaOneStation=P,s.clearStation=function(){"[]"===a.search().stationNames&&O()},s.clearTime=function(){e.timePeriod1CheckAll=function(){return!1},e.timePeriod1Check=function(){return!1},e.timePeriod2Check=function(){return!1},e.timePeriod3Check=function(){return!1},e.timePeriod4Check=function(){return!1},s.timePeriodAll=!1,s.searchFilters.timePeriod1=!1,s.searchFilters.timePeriod2=!1,s.searchFilters.timePeriod3=!1,s.searchFilters.timePeriod4=!1,s.update()},s.checkTimeAll=function(){console.log("qwertyu"),console.log(s.timePeriodAll),"yes"==s.timePeriodAll?(console.log("checktime true"),s.searchFilters.timePeriod1=!0,s.searchFilters.timePeriod2=!0,s.searchFilters.timePeriod3=!0,s.searchFilters.timePeriod4=!0,e.timePeriod1CheckAll=function(){return!0},e.timePeriod1Check=function(){return!1},e.timePeriod2Check=function(){return!1},e.timePeriod3Check=function(){return!1},e.timePeriod4Check=function(){return!1}):"no"==s.timePeriodAll&&(console.log("checktime false"),s.searchFilters.timePeriod1="",s.searchFilters.timePeriod2="",s.searchFilters.timePeriod3="",s.searchFilters.timePeriod4="")},s.checkTime=function(){e.timePeriodAll=!1,0==e.timePeriodAll&&(e.timePeriod1CheckAll=function(){return!1})},s.getSwiftPAYG=g,s.updateGrid=function(){t(function(){t(function(){if(s.filteredTickets.length){var e,t,o,a,i,n={passengerType:s.postedJSON.passengerType,timeBand:s.postedJSON.timeBand,brand:s.postedJSON.brand,stationNames:s.postedJSON.stationNames,busTravelArea:s.searchFilters.busTravelArea,operator:s.searchFilters.operator,buyOnDirectDebit:s.searchFilters.buyOnDirectDebit,buyOnDirectPurchase:s.searchFilters.buyOnDirectPurchase||null,buyOnSwift:s.searchFilters.buyOnSwift,hasOnlinePurchaseChannel:s.searchFilters.hasOnlinePurchaseChannel,purchaseTic:s.searchFilters.purchaseTic,purchaseRailStation:s.searchFilters.purchaseRailStation,purchasePayzone:s.searchFilters.purchasePayzone,railZoneFrom:s.searchFilters.railZoneFrom,railZoneTo:s.searchFilters.railZoneTo,limit:s.limit,limitExact:s.limitExact},c=l(n);s.postedJSON.allowBus&&(e="allowBus"),s.postedJSON.allowTrain&&(t="allowTrain"),s.postedJSON.allowMetro&&(o="allowMetro"),a=1==s.searchFilters.timePeriod1?"&timePeriod1=true&timePeriod2=false&timePeriod3=false&timePeriod4=false":1==s.searchFilters.timePeriod2?"&timePeriod1=false&timePeriod2=true&timePeriod3=false&timePeriod4=false":1==s.searchFilters.timePeriod3?"&timePeriod1=false&timePeriod2=false&timePeriod3=true&timePeriod4=false":1==s.searchFilters.timePeriod4?"&timePeriod1=false&timePeriod2=false&timePeriod3=false&timePeriod4=true":1==s.timePeriodAll?"&timePeriodAll=true":"",!s.postedJSON.allowBus||s.postedJSON.allowTrain||s.postedJSON.allowMetro||(i="/?"+e+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus&&s.postedJSON.allowTrain&&!s.postedJSON.allowMetro&&(i="/?"+e+"&"+t+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus&&!s.postedJSON.allowTrain&&s.postedJSON.allowMetro&&(i="/?"+e+"&"+o+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus||!s.postedJSON.allowTrain||s.postedJSON.allowMetro||(i="/?"+t+"&"+c+a,r.set("url",i)),!s.postedJSON.allowBus&&s.postedJSON.allowTrain&&s.postedJSON.allowMetro&&(i="/?"+t+"&"+o+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus||s.postedJSON.allowTrain||!s.postedJSON.allowMetro||(i="/?"+o+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus&&s.postedJSON.allowTrain&&s.postedJSON.allowMetro&&(i="/?"+e+"&"+t+"&"+o+"&"+c+a,r.set("url",i)),s.postedJSON.allowBus||s.postedJSON.allowTrain||s.postedJSON.allowMetro||(i="/?"+c+a,r.set("url",i)),h()}},0,!1)},0,!1)},s.refreshGrid=h,s.update=function(){var e=s.all,t=s.exactMatch,a=s.otherResults;angular.forEach(s.searchFilters,function(e,t){(-1!==t.indexOf("allow")&&e||!1===e&&-1===t.indexOf("allow"))&&delete s.searchFilters[t],s.searchFilters.timePeriod1&&(console.log("pre 930 test"),s.searchFilters.timePeriod2=!1,s.searchFilters.timePeriod3=!1,s.searchFilters.timePeriod4=!1),s.searchFilters.timePeriod2&&(s.searchFilters.timePeriod1=!1,s.searchFilters.timePeriod3=!1,s.searchFilters.timePeriod4=!1),s.searchFilters.timePeriod3&&(s.searchFilters.timePeriod1=!1,s.searchFilters.timePeriod2=!1,s.searchFilters.timePeriod4=!1),s.searchFilters.timePeriod4&&(s.searchFilters.timePeriod1=!1,s.searchFilters.timePeriod2=!1,s.searchFilters.timePeriod3=!1),"yes"==s.timePeriodAll&&(console.log("time anytime selected"),s.searchFilters.timePeriod1=!0,s.searchFilters.timePeriod2=!0,s.searchFilters.timePeriod3=!0,s.searchFilters.timePeriod4=!0)}),e=o("filter")(e,s.searchFilters),t=o("filter")(t,s.searchFilters),a=o("filter")(a,s.searchFilters),s.filteredTickets=o("orderBy")(e,s.orderBy),s.origTickets=o("orderBy")(t,s.orderBy),s.otherTickets=o("orderBy")(a,s.orderBy),s.updateGrid()},s.loadMore=function(){s.limit+=6,a.search("limit",s.limit),s.updateGrid()},s.loadMoreExact=function(){s.limitExact+=6,a.search("limitExact",s.limitExact),s.updateGrid()},s.filterButtons={operator:[],operatorLength:0,busTravelArea:[],railZoneFrom:[],railZoneTo:[]},s.toggleFilter=function(e){s.filterButtons[e]=!s.filterButtons[e]},s.swiftPAYG=N,s.ntrainOOC=function(){if(s.passValue=s.postJSON.brand,"ntrain - Out of County"===s.passValue)s.isHideCheck=!s.isHideCheck,e.stationFromReqOOC=!0,e.stationToReqOOC=!0,s.stationFromName=null,s.stationToName=null,s.stationViaOneName=null;else if(e.stationFromReqOOC=!1,e.stationToReqOOC=!1,a.search().stationNames){var t=a.search().stationNames,o=t.toString(),r=o.split(",");s.stationFromName=r[0],s.stationToName=r[1],s.stationViaOneName=r[2]}},s.toggleModalSwift=function(){s.modalShownSwift=!s.modalShownSwift},s.toggleModalFilter=function(){s.modalShownFilter=!s.modalShownFilter},c(),a.search().allowBus||a.search().allowMetro||a.search().allowTrain||a.search().brand&&a.search().passengerType&&a.search().timeBand||a.search().busTravelArea||a.search().operator||a.search().stationNames||a.search().brand){if(s.clearStation(),a.search().stationNames&&!0===s.postJSON.allowTrain||"nnetwork"===s.postJSON.brand||"ntrain"===s.postJSON.brand){if("[]"!=a.search().stationNames){var u=a.search().stationNames,m=u.toString(),f=m.split(",");s.stationFromName=f[0],s.stationToName=f[1],s.stationViaOneName=f[2]}}else s.stationFromName=null,s.stationToName=null;s.getStations(),d(s.postJSON)}else a.url("").replace();e.showDetails=!1,"Swift PAYG"===a.search().brand&&(g(),N());function d(t){s.loadingStatus="loading",angular.copy(s.postJSON,s.postedJSON),a.search({allowBus:s.postedJSON.allowBus,allowTrain:s.postedJSON.allowTrain,allowMetro:s.postedJSON.allowMetro,passengerType:s.postedJSON.passengerType,timeBand:s.postedJSON.timeBand,brand:s.postedJSON.brand,stationNames:s.postedJSON.stationNames,buyOnDirectDebit:e.buyOnDirectDebitParameter,buyOnDirectPurchase:e.buyOnDirectPurchaseParameter,buyOnSwift:e.buyOnSwiftParameter,hasOnlinePurchaseChannel:e.hasOnlinePurchaseChannelParameter,purchaseTic:e.purchaseTicParameter,purchaseRailStation:e.purchaseRailStationParameter,purchasePayzone:e.purchasePayzoneParameter,busTravelArea:e.busTravelAreaParameter,operator:e.operatorParameter,railZoneFrom:e.railZoneFromParameter,railZoneTo:e.railZoneToParameter,timePeriodAll:e.timePeriodAnytimeParameter,timePeriod1:e.timePeriod1Parameter,timePeriod2:e.timePeriod2Parameter,timePeriod3:e.timePeriod3Parameter,timePeriod4:e.timePeriod4Parameter,limit:s.limit,limitExact:s.limitExact}),s.searchFilters={},s.origFilters={},i.ticketSearch(t).then(function(e){s.all=e,s.original=e,angular.forEach(s.all,function(e){-1===s.filterButtons.operator.indexOf(e.operator)&&s.filterButtons.operator.push(e.operator),-1===s.filterButtons.busTravelArea.indexOf(e.busTravelArea)&&s.filterButtons.busTravelArea.push(e.busTravelArea),-1===s.filterButtons.railZoneFrom.indexOf(e.railZoneFrom)&&s.filterButtons.railZoneFrom.push(e.railZoneFrom),-1===s.filterButtons.railZoneTo.indexOf(e.railZoneTo)&&s.filterButtons.railZoneTo.push(e.railZoneTo)});var t=s.postedJSON.allowBus||!1,a=s.postedJSON.allowTrain||!1,r=s.postedJSON.allowMetro||!1;!0!==s.postJSON.allowTrain&&"nnetwork"!==s.postJSON.brand&&"ntrain"!==s.postJSON.brand||(null!=s.fromStationInfoZone?s.fromZoneNumber=s.fromStationInfoZone:null!=s.fromStationInfo?s.fromZoneNumber=s.fromStationInfo.zone:s.fromZoneNumber=null,null!=s.toStationInfoZone?s.toZoneNumber=s.toStationInfoZone:null!=s.toStationInfo?s.toZoneNumber=s.toStationInfo.zone:s.toZoneNumber=null,1==s.fromZoneNumber?s.ffromzone=1:2==s.fromZoneNumber?s.ffromzone=2:3==s.fromZoneNumber?s.ffromzone=3:4==s.fromZoneNumber?s.ffromzone=4:5==s.fromZoneNumber?s.ffromzone=5:s.ffromzone=null,1==s.toZoneNumber?s.ftozone=1:2==s.toZoneNumber?s.ftozone=2:3==s.toZoneNumber?s.ftozone=3:4==s.toZoneNumber?s.ftozone=4:5==s.toZoneNumber?s.ftozone=5:s.ftozone=null,1==s.ViaOneZoneNumber?s.fViaOnezone=1:2==s.ViaOneZoneNumber?s.fViaOnezone=2:3==s.ViaOneZoneNumber?s.fViaOnezone=3:4==s.ViaOneZoneNumber?s.fViaOnezone=4:5==s.ViaOneZoneNumber?s.fViaOnezone=5:s.fViaOnezone=null,null!=s.ViaOneZoneNumber&&(s.ViaOneZoneNumber<s.fromZoneNumber?s.ffromzone=s.ViaOneZoneNumber:s.ViaOneZoneNumber>s.toZoneNumber&&(s.ftozone=s.ViaOneZoneNumber))),!0===s.postJSON.allowTrain?(s.exactMatch=[],null!==s.fromZoneNumber&&null!==s.toZoneNumber?s.ffromzone<s.ftozone?s.exactMatch=o("filter")(e,{allowBus:t,allowTrain:a,allowMetro:r,railZoneFrom:s.ffromzone,railZoneTo:s.ftozone}):s.ffromzone>s.ftozone?s.exactMatch=o("filter")(e,{allowBus:t,allowTrain:a,allowMetro:r,railZoneFrom:s.ftozone,railZoneTo:s.ffromzone}):s.ffromzone===s.ftozone&&(s.exactMatch=o("filter")(e,{allowBus:t,allowTrain:a,allowMetro:r,railZoneFrom:1,railZoneTo:s.ftozone})):s.exactMatch=o("filter")(e,{allowBus:t,allowTrain:a,allowMetro:r})):"nnetwork"===s.postJSON.brand||"ntrain"===s.postJSON.brand?(s.exactMatch=[],null!==s.fromZoneNumber&&null!==s.toZoneNumber?s.ffromzone<s.ftozone?s.exactMatch=o("filter")(e,{railZoneFrom:s.ffromzone,railZoneTo:s.ftozone}):s.ffromzone>s.ftozone?s.exactMatch=o("filter")(e,{railZoneFrom:s.ftozone,railZoneTo:s.ffromzone}):s.ffromzone===s.ftozone&&(s.exactMatch=o("filter")(e,{railZoneFrom:1,railZoneTo:s.ftozone})):s.exactMatch=o("filter")(e,{})):(s.postedJSON.stationNames=null,s.exactMatch=o("filter")(e,{allowBus:t,allowTrain:a,allowMetro:r}));for(var i=s.all,n=s.exactMatch,l=0;l<n.length;l++)for(var c=i.length,u=0;u<c;u++)n[l]===i[u]&&(i=i.slice(0,u).concat(i.slice(u+1,c)));s.otherResults=i;var m=s.postedJSON.allowBus,f=s.postedJSON.allowTrain,d=s.postedJSON.allowMetro;(null!==m||null!==m&&null!==f||null!==m&&null!==d||null!==f&&null!==d)&&s.toggleFilter("mode"),null!==m&&null!==f&&null!==d&&s.toggleFilter("payment"),s.update(),s.loadingStatus="success"})}function h(){t(function(){t(function(){n.ticketResults.refresh(),n.origTicketResults.refresh()},900,!1)},900,!1)}function p(){s.postJSON.allowBus=null,s.postJSON.allowTrain=null,s.postJSON.allowMetro=null}function O(){e.$broadcast("angucomplete-alt:clearInput","stationFrom"),s.stationFromName=null,s.postJSON.stationNames=[[]],e.stationFromReq=!1,e.stationFromNameOocZ5=null,s.fromStationInfoZone=null,e.fromStationText=null}function S(){e.$broadcast("angucomplete-alt:clearInput","stationTo"),s.stationToName=null,s.postJSON.stationNames=[[]],e.stationToReq=!1,e.stationToNameOocZ5=null,s.toStationInfoZone=null,e.toStationText=null}e.fromEmpty="none",e.fromStationInputChanged=function(t){e.fromStationText=t},e.fromfocusState="None",e.fromFocusIn=function(){e.fromfocusState="In"},e.fromFocusOut=function(){e.fromfocusState="Out",null!=s.stationToName&&(e.stationFromReq=!0),null!=e.fromStationText&&null==s.stationFromName&&(e.stationFromReq=!0)},e.stationFromReq=!1,e.stationFromReqOOC=!0,e.stationFrom=function(t){t?(s.stationFromName=t.originalObject.name,s.postJSON.stationNames[0]=t.originalObject.name,e.stationFromNameZone=t.originalObject.zone,e.stationFromNameOoc=t.originalObject.outOfCounty,e.stationFromNameOocZ5=t.originalObject.zone5InCounty,s.fromZoneNumber=t.originalObject.zone,s.fromStationInfoZone=t.originalObject.zone,e.stationFromReq=!1,e.fromEmpty=!0):(s.stationFromName=null,s.postJSON.stationNames[0]=null,e.stationFromReq=!1,e.fromEmpty=!1)},e.toEmpty="none",e.toStationInputChanged=function(t){e.toStationText=t},e.tofocusState="None",e.toFocusIn=function(){e.tofocusState="In",null!=s.stationFromName&&(e.stationToReq=!0)},e.toFocusOut=function(){e.tofocusState="Out",null!=s.stationFromName&&(e.stationToReq=!0),null!=e.toStationText&&null==s.stationToName&&(e.stationToReq=!0)},e.stationToReq=!1,e.stationToReqOOC=!0,e.stationTo=function(t){t?(s.stationToName=t.originalObject.name,s.postJSON.stationNames[1]=t.originalObject.name,e.stationToTitle=t.originalObject.name,e.stationToNameZone=t.originalObject.zone,e.stationToNameOoc=t.originalObject.outOfCounty,e.stationToNameOocZ5=t.originalObject.zone5InCounty,s.toZoneNumber=t.originalObject.zone,s.toStationInfoZone=t.originalObject.zone,e.stationToReq=!1,e.toEmpty=!0):(s.stationToName=null,s.postJSON.stationNames[1]=null,e.stationToTitle=null,e.toEmpty=!1)},e.viaOneStationInputChanged=function(t){e.viaOneStationText=t},e.viaOnefocusState="None",e.stationViaOneFocusIn=function(){e.viaOnefocusState="In"},e.stationViaOneFocusOut=function(){e.viaOnefocusState="Out",null!=s.stationViaOneName&&(e.stationviaOneReq=!0),null==e.viaOneStationText&&null!=s.stationViaOneName||(e.stationViaOneReq=!0,e.stationToReq=!0,e.stationFromReq=!0)},e.stationViaOne=function(t){t&&(s.stationViaOneName=t.originalObject.name,s.postJSON.stationNames[2]=t.originalObject.name,e.stationViaOneTitle=t.originalObject.name,e.stationViaOneNameZone=t.originalObject.zone,e.stationViaOneNameOoc=t.originalObject.outOfCounty,e.stationViaOneNameOocZ5=t.originalObject.zone5InCounty,s.ViaOneZoneNumber=t.originalObject.zone,s.ViaOneStationInfoZone=t.originalObject.zone)},null!=s.stationViaOneName&&(e.stationVia=!0);function P(){e.$broadcast("angucomplete-alt:clearInput","stationViaOne"),e.stationViaOneName=null,e.viaOneStationText=null,s.stationViaOneName=null,s.postJSON.stationNames=[[]]}e.buyOnDirectDebitParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.buyOnDirectDebit=!0,e.buyOnDirectDebitCheck=function(){return!0});e.buyOnDirectPurchaseParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.buyOnDirectPurchase=!0,e.buyOnDirectPurchaseCheck=function(){return!0});e.buyOnSwiftParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.buyOnSwift=!0,e.buyOnSwiftCheck=function(){return!0});e.hasOnlinePurchaseChannelParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.hasOnlinePurchaseChannel=!0,e.hasOnlinePurchaseChannelCheck=function(){return!0});e.purchaseTicParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.purchaseTic=!0,e.purchaseTicCheck=function(){return!0});e.purchaseRailStationParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.purchaseRailStation=!0,e.purchaseRailStationCheck=function(){return!0});e.purchasePayzoneParameter&&(s.filterButtons.payment=!s.filterButtons.payment,s.searchFilters.purchasePayzone=!0,e.purchasePayzoneCheck=function(){return!0});e.busTravelAreaParameter&&(s.filterButtons.busTravelAreaBtn=!s.filterButtons.busTravelAreaBtn,s.searchFilters.busTravelArea=e.busTravelAreaParameter);e.operatorParameter&&(s.filterButtons.operatorBtn=!s.filterButtons.operatorBtn,s.searchFilters.operator=e.operatorParameter);e.railZoneFromParameter&&(s.filterButtons.railZoneBtn=!s.filterButtons.railZoneBtn,s.searchFilters.railZoneFrom=e.railZoneFromParameter);e.railZoneToParameter&&(s.filterButtons.railZoneBtn=!s.filterButtons.railZoneBtn,s.searchFilters.railZoneTo=e.railZoneToParameter);"true"==a.search().timePeriodAll&&(s.searchFilters.timeLimited=!1,s.searchFilters.timePeriod1="",s.filterButtons.time=!s.filterButtons.time,s.timePeriodAll=!0,e.timePeriod1CheckAll=function(){return!0});"true"==a.search().timePeriod1&&(s.filterButtons.time=!s.filterButtons.time,s.searchFilters.timePeriod1=!0,e.timePeriod1Check=function(){return!0});"true"==a.search().timePeriod2&&(s.filterButtons.time=!s.filterButtons.time,s.searchFilters.timePeriod2=!0,e.timePeriod2Check=function(){return!0});"true"==a.search().timePeriod3&&(s.filterButtons.time=!s.filterButtons.time,s.searchFilters.timePeriod3=!0,e.timePeriod3Check=function(){return!0});"true"==a.search().timePeriod4&&(s.filterButtons.time=!s.filterButtons.time,s.searchFilters.timePeriod4=!0,e.timePeriod4Check=function(){return!0});function N(){s.passValue=s.postJSON.brand,"Swift PAYG"===s.passValue?(s.isHideCheck=!s.isHideCheck,s.postJSON.passengerType=null,s.postJSON.timeBand=null,s.postJSON.stationNames=[]):"nbus"!==s.passValue&&"National Express"!==s.passValue&&"Diamond Bus"!==s.passValue&&"Stagecoach"!==s.passValue&&"Swift PAYG"!==s.passValue&&"West Midlands Metro"!==s.passValue||(s.postJSON.stationNames=[[]])}function g(){i.getSwiftSearch().then(function(e){s.swiftPaygTickets=e})}s.modalShownSwift=!1,s.hideModalFilter=function(){s.modalShownFilter=!s.modalShownFilter},s.modalShownFilter=!1,e.date=new Date}]).filter("removeHTMLTags",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}]).filter("escapeFilter",[function(){return function(e){return e?String(e).replace(/\n/gm,"<br><br>"):""}}]).filter("replace",[function(){return function(e,t,o){if(void 0!==e){var a=new RegExp(t,"g");return e.replace(a,o)}}}]).directive("initialSearch",[function(){return{templateUrl:assetPath+"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:assetPath+"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:assetPath+"partials/search-results/filters.html",restrict:"E"}}]).directive("filtersMobile",[function(){return{templateUrl:assetPath+"partials/search-results/filters-mobile.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",function(e,t){return{templateUrl:assetPath+"partials/search-results/item.html",restrict:"E",link:function(o,a,r){o.$$postDigest(function(){angular.element(document).ready(function(){e(function(){t.ticketResults.refresh(),t.origTicketResults.refresh()},0)})})}}}]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams","$scope","$timeout",function(e,t,o,a,r,i){var n=this;r.assetPath=assetPath,r.ticketUrl=ticketUrl,n.loadingText="Loading...",n.loadingStatus="loading",n.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],n.loading=t(function(){n.loadingText=n.loadingArray[Math.round(Math.random()*(n.loadingArray.length-1))]},3500),n.ticketID=a.ticket,n.filterAccordions={},n.relatedTickets={},n.toggleClick=function(e){n.filterAccordions[e]=!n.filterAccordions[e]},n.modalShown=!1,n.toggleModal=function(){n.modalShown=!n.modalShown},n.toggleModalBus=function(){n.modalShownBus=!n.modalShownBus},n.toggleModalTrain=function(){n.modalShownTrain=!n.modalShownTrain},n.toggleModalSwift=function(){n.modalShownSwift=!n.modalShownSwift},n.operatorList=[],n.limit=4,n.openFilters=function(){document.getElementById("filterOverlay").style.display="block"},n.closeFilters=function(){document.getElementById("filterOverlay").style.display="none"},l=n.ticketID,e.getTicket(l).then(function(t){n.all=t,n.all.relatedTickets.length&&(n.related=[],angular.forEach(n.all.relatedTickets,function(t){e.getSimpleTicket(t.id).then(function(e){n.relatedTickets[t.id]=e,n.relatedList=n.relatedTickets[t.id],n.related.push(n.relatedList)})},n.related)),n.all.documents.length&&e.getTerms(l).then(function(e){n.relatedTerms=e}),e.getOperators().then(function(e){n.operatorList=e}),n.backToSearch=o,r.stationFromNameZone="1"}),n.modalShownBus=!1,n.modalShownTrain=!1,n.modalShown=!1,n.modalShownSwift=!1,i(function(){n.loadingStatus="success"},0);var l}]).directive("detailDetails",[function(){return{templateUrl:assetPath+"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:assetPath+"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:assetPath+"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",["$timeout","angularGridInstance",function(e,t){return{templateUrl:assetPath+"partials/detail/related-product.html",restrict:"E",link:function(o,a,r){o.$$postDigest(function(){angular.element(document).ready(function(){e(function(){t.alternativeResults.refresh()},0)})})}}}]).directive("detailWhere",[function(){return{templateUrl:assetPath+"partials/detail/where-can-i-use.html",restrict:"E"}}]).directive("operators",[function(){return{templateUrl:assetPath+"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,o){e.dialogStyle={},o.width&&(e.dialogStyle.width=o.width),o.height&&(e.dialogStyle.height=o.height),o.modalclass&&(e.dialogStyle.class=o.modalclass),e.hideModal=function(){e.show=!1}},template:'<div ng-show="show" class="mod"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="overlay modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(e){var t=e.panes=[];e.select=function(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(o){0===t.length&&e.select(o),t.push(o)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,t,o,a){a.addPane(e)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}]).directive("tooltip",[function(){return{restrict:"A",controller:["$scope",function(e,t){e.isShown=!1,this.showHover=function(){e.isShown=!0!==e.isShown}}],transclude:!0,link:function(e,t,o,a){e.copy=o.tooltipc,t.bind("click",function(){e.$apply(function(){a.showHover()})})},template:'<div ng-transclude></div><p class="field-help tooltip" ng-show="isShown"><span class="close modal__close"></span><span data-ng-bind-html="copy"></span></p>'}}])}();