!function(){"use strict";function t(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(i,n,a){t(function(){i.$last&&e.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(t,e,i,n,a,o,l){var r=this;function s(){r.all=[],r.filteredTickets=[],r.stationList=[],r.stationoocList=[],r.swiftPaygTickets=[],r.loadingStatus="",r.passValue="",r.orderBy="TicketCurrentAmount",r.limit=parseInt(n.search().limit)||6,r.postJSON={allowBus:n.search().allowBus||null,allowMetro:n.search().allowMetro||null,allowTrain:n.search().allowTrain||null,passengerType:n.search().passengerType||"",timeBand:n.search().timeBand||"",brand:n.search().brand||null,stationNames:[n.search().stationNames||[[]]]},r.clearModes=u,r.postedJSON={}}r.submit=c,r.clearFilter=function(){n.url("").replace(),s()},r.getStations=function(){o.getStations().then(function(t){r.stationList=t,console.log(t)})},r.getoocStations=function(){o.getStations().then(function(t){var e=i("filter")(t,{OutOfCounty:"true"});r.stationoocList=e,console.log(e)})},r.getSwiftPAYG=f,r.updateGrid=function(){e(function(){e(function(){r.filteredTickets.length&&(l.ticketResults.refresh(),a.set("url",n.url()))},82,!1)},82,!1)},r.update=function(){var t=r.all;console.log(r.searchFilters),angular.forEach(r.searchFilters,function(t,e){(-1!==e.indexOf("allow")&&t||0==t&&-1===e.indexOf("allow"))&&delete r.searchFilters[e]}),t=i("filter")(t,r.searchFilters),r.filteredTickets=i("orderBy")(t,r.orderBy),console.log(r.filteredTickets),console.log(r.searchFilters),r.updateGrid()},r.loadMore=function(){r.limit+=6,n.search("limit",r.limit),r.updateGrid()},r.filterButtons={operator:[],operatorLength:0,busTravelArea:[],railZoneFrom:[],railZoneTo:[]},r.toggleFilter=function(t){r.filterButtons[t]=!r.filterButtons[t]},r.swiftPAYG=d,r.ntrainOOC=function(){r.passValue=r.postJSON.brand,"ntrain - Out of County"==r.passValue&&(r.isHideCheck=!r.isHideCheck)},s(),n.search().allowBus||n.search().allowMetro||n.search().allowTrain||n.search().brand&&n.search().passengerType&&n.search().timeBand||n.search().stationNames?c(r.postJSON):n.url("").replace();"Swift PAYG"==n.search().brand&&(f(),d());function c(t){r.loadingStatus="loading",angular.copy(r.postJSON,r.postedJSON),n.search({allowBus:r.postedJSON.allowBus,allowTrain:r.postedJSON.allowTrain,allowMetro:r.postedJSON.allowMetro,passengerType:r.postedJSON.passengerType,timeBand:r.postedJSON.timeBand,brand:r.postedJSON.brand,stationNames:[r.postedJSON.stationNames],limit:r.limit}),r.searchFilters={},console.log("this is posted"),console.log(r.postedJSON),o.ticketSearch(t).then(function(t){r.all=t,console.log("ticket search"),console.log(t),angular.forEach(r.all,function(t){-1==r.filterButtons.operator.indexOf(t.Operator)&&r.filterButtons.operator.push(t.Operator),-1==r.filterButtons.busTravelArea.indexOf(t.BusTravelArea)&&r.filterButtons.busTravelArea.push(t.BusTravelArea),-1==r.filterButtons.railZoneFrom.indexOf(t.RailZoneFrom)&&r.filterButtons.railZoneFrom.push(t.RailZoneFrom),-1==r.filterButtons.railZoneTo.indexOf(t.RailZoneTo)&&r.filterButtons.railZoneTo.push(t.RailZoneTo)}),r.update(),r.loadingStatus="success"})}function u(){r.postJSON.allowBus=null,r.postJSON.allowTrain=null,r.postJSON.allowMetro=null,r.postJSON.stationNames=[]}function d(){r.passValue=r.postJSON.brand,"Swift PAYG"==r.passValue&&(r.isHideCheck=!r.isHideCheck,r.postJSON.passengerType=null,r.postJSON.timeBand=null,r.postJSON.stationNames=[])}function f(){o.getSwiftSearch().then(function(t){r.swiftPaygTickets=t,console.log("swift search"),console.log(t)})}t.stationFromName={Name:""},t.stationFrom=function(e){e?(t.stationFromName=e.originalObject.name,console.log(e),console.log("From station"+e.originalObject.Name),r.postJSON.stationNames[0]=e.originalObject.Name):(t.stationFromName=null,r.postJSON.StationNames[0]=null)},t.stationTo=function(t){t&&(console.log(t),r.postJSON.stationNames[1]=t.originalObject.Name)}}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(e,i){return angular.forEach({},function(e,i){console.log(i,e),console.log(t[i])}),angular.forEach(e,function(t){}),[]}}]).filter("escapeFilter",[function(){return function(t){return t?String(t).replace(/\n/gm,"<br><br>"):""}}]).filter("replace",[function(){return function(t,e,i){if(void 0!==t){var n=new RegExp(e,"g");return t.replace(n,i)}}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",t]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(t,e,i,n){var a=this;a.loadingText="Loading...",a.loadingStatus="Loading",a.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],a.loading=e(function(){a.loadingText=a.loadingArray[Math.round(Math.random()*(a.loadingArray.length-1))]},3500),a.ticketID=n.ticket,a.filterAccordions={},a.relatedTickets={},a.toggleClick=function(t){a.filterAccordions[t]=!a.filterAccordions[t]},a.modalShown=!1,a.toggleModal=function(){a.modalShown=!a.modalShown},a.operatorList=[],a.limit=4,o=a.ticketID,t.getTicket(o).then(function(e){a.all=e,console.log(e),a.all.relatedTickets.length?angular.forEach(a.all.relatedTickets,function(e){t.getSimpleTicket(e.id).then(function(t){a.relatedTickets[e.id]=t,console.log(a.relatedTickets[e.id]),a.loadingStatus="Success"})}):a.loadingStatus="Success",a.all.documents.length?t.getTerms(o).then(function(t){a.relatedTerms=t,a.loadingStatus="Success"}):a.loadingStatus="Success",t.getOperators().then(function(t){a.operatorList=t,console.log(t),a.loadingStatus="Success"}),a.backToSearch=i,console.log(a.backToSearch)});var o}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",["$timeout","angularGridInstance",function(t,e){return{templateUrl:"partials/detail/related-product.html",restrict:"E",link:function(i,n,a){t(function(){i.$last&&e.alternativeResults.refresh()},0)}}}]).directive("operators",[function(){return{templateUrl:"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(t,e,i){t.dialogStyle={},i.width&&(t.dialogStyle.width=i.width),i.height&&(t.dialogStyle.height=i.height),i.class&&(t.dialogStyle.class=i.class),t.hideModal=function(){t.show=!1}},template:'<div ng-show="show"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="ng-modal-dialog boxin modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(t){var e=t.panes=[];t.select=function(t){angular.forEach(e,function(t){t.selected=!1}),t.selected=!0},this.addPane=function(i){0==e.length&&t.select(i),e.push(i)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(t,e,i,n){n.addPane(t)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}]).directive("tooltip",[function(){return{restrict:"A",controller:function(t,e){t.isShown=!1,this.showHover=function(){t.isShown=1!=t.isShown}},transclude:!0,link:function(t,e,i,n){e.bind("click",function(){t.$apply(function(){n.showHover()})})},template:'<div ng-transclude></div><p class="field-help tooltip" ng-class="field-help tooltip" ng-show="isShown"><span data-ng-bind-html="features.description">{{features.description}}</span></p>'}}])}();