!function(){"use strict";function e(e,t){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(i,l,a){e(function(){i.$last&&t.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(e,t,i,l,a,n,r){var o=this;function s(){o.all=[],o.filteredTickets=[],o.stationList=[],o.loadingStatus="",o.passValue="",o.orderBy="TicketCurrentAmount",o.limit=parseInt(l.search().limit)||6,o.postJSON={AllowBus:l.search().AllowBus||null,AllowMetro:l.search().AllowMetro||null,AllowTrain:l.search().AllowTrain||null,PassengerType:l.search().PassengerType||"",TimeBand:l.search().TimeBand||"",Brand:l.search().Brand||null,StationNames:[]},o.clearModes=u,o.postedJSON={}}o.submit=c,o.clearFilter=function(){l.url("").replace(),s()},o.getStations=function(){n.getStations().then(function(e){o.stationList=e})},o.updateGrid=function(){t(function(){t(function(){o.filteredTickets.length&&(r.ticketResults.refresh(),a.set("url",l.url()))},82,!1)},82,!1)},o.update=function(){var e=o.all;console.log(o.searchFilters),angular.forEach(o.searchFilters,function(e,t){(-1!==t.indexOf("Allow")&&e||0==e&&-1===t.indexOf("Allow"))&&delete o.searchFilters[t]}),e=i("filter")(e,o.searchFilters),o.filteredTickets=i("orderBy")(e,o.orderBy),console.log(o.filteredTickets),console.log(o.searchFilters),o.updateGrid()},o.loadMore=function(){o.limit+=6,l.search("limit",o.limit),o.updateGrid()},o.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},o.toggleFilter=function(e){o.filterButtons[e]=!o.filterButtons[e]},o.swiftPAYG=function(){o.passValue=o.postJSON.Brand,"Swift PAYG"==o.passValue&&(o.isHideCheck=!o.isHideCheck,o.postJSON.PassengerType=null,o.postJSON.TimeBand=null,o.postJSON.StationNames=null)},s(),l.search().AllowBus||l.search().AllowMetro||l.search().AllowTrain||l.search().Brand&&l.search().PassengerType&&l.search().TimeBand||l.search().StationNames?c(o.postJSON):l.url("").replace();function c(e){o.loadingStatus="loading",angular.copy(o.postJSON,o.postedJSON),l.search({AllowBus:o.postedJSON.AllowBus,AllowTrain:o.postedJSON.AllowTrain,AllowMetro:o.postedJSON.AllowMetro,PassengerType:o.postedJSON.PassengerType,TimeBand:o.postedJSON.TimeBand,Brand:o.postedJSON.Brand,StationNames:[o.postJSON.StationNames],limit:o.limit}),o.searchFilters={},console.log("this is posted"),console.log(o.postedJSON),n.ticketSearch(e).then(function(e){o.all=e,angular.forEach(o.all,function(e){-1==o.filterButtons.Operator.indexOf(e.Operator)&&o.filterButtons.Operator.push(e.Operator),-1==o.filterButtons.BusTravelArea.indexOf(e.BusTravelArea)&&o.filterButtons.BusTravelArea.push(e.BusTravelArea),-1==o.filterButtons.RailZoneFrom.indexOf(e.RailZoneFrom)&&o.filterButtons.RailZoneFrom.push(e.RailZoneFrom),-1==o.filterButtons.RailZoneTo.indexOf(e.RailZoneTo)&&o.filterButtons.RailZoneTo.push(e.RailZoneTo)}),o.update(),o.loadingStatus="success"})}function u(){o.postJSON.AllowBus=null,o.postJSON.AllowTrain=null,o.postJSON.AllowMetro=null,o.postJSON.StationNames=null}e.stationFrom=function(e){e&&(console.log(e),o.postJSON.StationNames[0]=e.originalObject.Name)},e.stationTo=function(e){e&&(console.log(e),o.postJSON.StationNames[1]=e.originalObject.Name)}}]).filter("removeHTMLTags",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,i){return angular.forEach({},function(t,i){console.log(i,t),console.log(e[i])}),angular.forEach(t,function(e){}),[]}}]).filter("escapeFilter",[function(){return function(e){return e?String(e).replace(/\n/gm,"<br><br>"):""}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",e]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(e,t,i,l){var a=this;a.loadingText="Loading...",a.loadingStatus="Loading",a.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],a.loading=t(function(){a.loadingText=a.loadingArray[Math.round(Math.random()*(a.loadingArray.length-1))]},3500),a.ticketID=l.ticket,a.filterAccordions={},a.relatedTickets={},a.toggleClick=function(e){a.filterAccordions[e]=!a.filterAccordions[e]},a.modalShown=!1,a.toggleModal=function(){a.modalShown=!a.modalShown},a.operatorList=[],n=a.ticketID,e.getTicket(n).then(function(t){a.all=t,console.log(t),a.all.RelatedTickets.length?angular.forEach(a.all.RelatedTickets,function(t){e.getSimpleTicket(t.Id).then(function(e){a.relatedTickets[t.Id]=e,a.loadingStatus="Success"})}):a.loadingStatus="Success",a.all.Documents.length?e.getTerms(n).then(function(e){a.relatedTerms=e,a.loadingStatus="Success"}):a.loadingStatus="Success","Ticket"==a.all.Type?e.getOperators().then(function(e){a.operatorList=e,console.log(e),a.loadingStatus="Success"}):a.loadingStatus="Success",a.backToSearch=i,console.log(a.backToSearch)});var n}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",[function(){return{templateUrl:"partials/detail/related-product.html",restrict:"E"}}]).directive("operators",[function(){return{templateUrl:"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,i){e.dialogStyle={},i.width&&(e.dialogStyle.width=i.width),i.height&&(e.dialogStyle.height=i.height),e.hideModal=function(){e.show=!1}},template:"<div ng-show='show'><div ng-show='show' class='modal' ng-click='hideModal()'></div><div class='ng-modal-dialog boxin bdr-top--blue modal-content' ng-style='dialogStyle'><div class='ng-modal-close modal__close js-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>"}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(e){var t=e.panes=[];e.select=function(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(i){0==t.length&&e.select(i),t.push(i)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,t,i,l){l.addPane(e)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}])}();