!function(){"use strict";function t(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(r,i,l){t(function(){r.$last&&e.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",[]).controller("TicketingSearchCtrl",["$timeout","$filter","$location","ticketingService","angularGridInstance",function(t,e,r,i,l){var n=this;function o(){n.all=[],n.filteredTickets=[],n.loadingStatus="",n.orderBy="TicketCurrentAmount",n.limit=parseInt(r.search().limit)||6,n.postJSON={AllowBus:null,AllowMetro:null,AllowTrain:null,PassengerType:"",Timeband:""},n.postedJSON={}}n.submit=function(t){n.loadingStatus="loading",angular.copy(n.postJSON,n.postedJSON),n.searchFilters={},console.log("this is posted"),console.log(n.postedJSON),i.ticketSearch(t).then(function(t){n.all=t,angular.forEach(n.all,function(t){-1==n.filterButtons.Operator.indexOf(t.Operator)&&n.filterButtons.Operator.push(t.Operator),-1==n.filterButtons.BusTravelArea.indexOf(t.BusTravelArea)&&n.filterButtons.BusTravelArea.push(t.BusTravelArea),-1==n.filterButtons.RailZoneFrom.indexOf(t.RailZoneFrom)&&n.filterButtons.RailZoneFrom.push(t.RailZoneFrom),-1==n.filterButtons.RailZoneTo.indexOf(t.RailZoneTo)&&n.filterButtons.RailZoneTo.push(t.RailZoneTo)}),n.update(),n.loadingStatus="success"})},n.clearFilter=function(){r.url("").replace(),o()},n.updateGrid=function(){t(function(){t(function(){n.filteredTickets.length&&l.ticketResults.refresh()},82,!1)},82,!1)},n.update=function(){var t=n.all;console.log(n.searchFilters),angular.forEach(n.searchFilters,function(t,e){(-1!==e.indexOf("Allow")&&t||0==t&&-1===e.indexOf("Allow"))&&delete n.searchFilters[e]}),t=e("filter")(t,n.searchFilters),n.filteredTickets=e("orderBy")(t,n.orderBy),console.log(n.filteredTickets),console.log(n.searchFilters),n.updateGrid()},n.loadMore=function(){n.limit+=6,r.search("limit",n.limit),n.updateGrid()},n.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},n.toggleFilter=function(t){n.filterButtons[t]=!n.filterButtons[t]},o()}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(e,r){return angular.forEach({},function(e,r){console.log(r,e),console.log(t[r])}),angular.forEach(e,function(t){}),[]}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",t]).controller("TicketDetailCtrl",["ticketingService","$routeParams",function(t,e){var r=this;r.ticketID=e.ticket,i=r.ticketID,t.getTicket(i).then(function(t){r.all=t,console.log(t)});var i}])}();