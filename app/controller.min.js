!function(){"use strict";angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance","$httpParamSerializer",function(t,e,o,a,l,n,i,s){var r=this;function c(){r.all=[],r.filteredTickets=[],r.stationList=[],r.stationoocList=[],r.stationicList=[],r.swiftPaygTickets=[],r.loadingStatus="",r.passValue="",r.orderBy="ticketCurrentAmount",r.limit=parseInt(a.search().limit)||6,r.postJSON={allowBus:a.search().allowBus||null,allowMetro:a.search().allowMetro||null,allowTrain:a.search().allowTrain||null,passengerType:a.search().passengerType||"",timeBand:a.search().timeBand||"",busTravelArea:a.search().busTravelArea||null,operator:a.search().operator||null,brand:a.search().brand||null,stationNames:a.search().stationNames||[[]]},r.clearModes=d,r.postedJSON={}}r.submit=u,r.clearFilter=function(){a.url("").replace(),c(),t.stationFromName=null,t.stationToName=null,t.stationFromTitle=null,t.stationToTitle=null,t.stationFromNameOocZ5=null,t.stationToNameOocZ5=null},r.getStations=function(){n.getStations().then(function(t){r.stationList=t})},r.getoocStations=function(){n.getStations().then(function(t){var e=o("filter")(t,{OutOfCounty:"true"});r.stationoocList=e})},r.geticStations=function(){n.getStations().then(function(t){var e=o("filter")(t,{OutOfCounty:"false"});r.stationicList=e})},r.clearFromStation=function(){t.$broadcast("angucomplete-alt:clearInput","stationFrom"),t.stationFromName=null,r.postJSON.stationNames=[[]],t.stationFromReq=!1,t.stationFromNameOocZ5=null},r.clearToStation=function(){t.$broadcast("angucomplete-alt:clearInput","stationTo"),t.stationToName=null,r.postJSON.stationNames=[[]],t.stationToReq=!1,t.stationToNameOocZ5=null},r.clearStation=function(){"[]"==t.stationFromName&&(t.stationFromName=null)},r.getSwiftPAYG=m,r.updateGrid=function(){e(function(){e(function(){if(r.filteredTickets.length){i.ticketResults.refresh();var t={passengerType:r.postedJSON.passengerType,timeBand:r.postedJSON.timeBand,brand:r.postedJSON.brand,stationNames:r.postedJSON.stationNames,busTravelArea:r.searchFilters.busTravelArea,operator:r.searchFilters.operator,limit:r.limit},e=s(t);if(r.postedJSON.allowBus)var o="allowBus";if(r.postedJSON.allowTrain)var a="allowTrain";if(r.postedJSON.allowMetro)var n="allowMetro";if(r.postedJSON.allowBus&&!r.postedJSON.allowTrain&&!r.postedJSON.allowMetro){var c="/?"+o+"&"+e;console.log("bus only - "+c),l.set("url",c)}if(r.postedJSON.allowBus&&r.postedJSON.allowTrain&&!r.postedJSON.allowMetro){var c="/?"+o+"&"+a+"&"+e;console.log(c),l.set("url",c)}if(r.postedJSON.allowBus&&!r.postedJSON.allowTrain&&r.postedJSON.allowMetro){var c="/?"+o+"&"+n+"&"+e;console.log(c),l.set("url",c)}if(!r.postedJSON.allowBus&&r.postedJSON.allowTrain&&!r.postedJSON.allowMetro){var c="/?"+a+"&"+e;console.log(c),l.set("url",c)}if(!r.postedJSON.allowBus&&r.postedJSON.allowTrain&&r.postedJSON.allowMetro){var c="/?"+a+"&"+n+"&"+e;console.log(c),l.set("url",c)}if(!r.postedJSON.allowBus&&!r.postedJSON.allowTrain&&r.postedJSON.allowMetro){var c="/?"+n+"&"+e;console.log(c),l.set("url",c)}if(r.postedJSON.allowBus&&r.postedJSON.allowTrain&&r.postedJSON.allowMetro){var c="/?"+o+"&"+a+"&"+n+"&"+e;console.log(c),l.set("url",c)}if(!r.postedJSON.allowBus&&!r.postedJSON.allowTrain&&!r.postedJSON.allowMetro){var c="/?"+e;console.log(c),l.set("url",c)}}},82,!1)},82,!1)},r.update=function(){var t=r.all;console.log(r.searchFilters),angular.forEach(r.searchFilters,function(t,e){(-1!==e.indexOf("allow")&&t||0==t&&-1===e.indexOf("allow"))&&delete r.searchFilters[e]}),t=o("filter")(t,r.searchFilters),r.filteredTickets=o("orderBy")(t,r.orderBy),console.log("Fitered Tickets:"),console.log(r.filteredTickets),console.log("Search Filters:"),console.log(r.searchFilters),r.updateGrid()},r.loadMore=function(){r.limit+=6,a.search("limit",r.limit),r.updateGrid()},r.filterButtons={operator:[],operatorLength:0,busTravelArea:[],railZoneFrom:[],railZoneTo:[]},r.toggleFilter=function(t){r.filterButtons[t]=!r.filterButtons[t]},r.toggleFilterClose=function(){$(".filter-title").collapse("hide")},r.swiftPAYG=p,r.ntrainOOC=function(){r.passValue=r.postJSON.brand,"ntrain - Out of County"==r.passValue&&(r.isHideCheck=!r.isHideCheck)},r.toggleModalSwift=function(){r.modalShownSwift=!r.modalShownSwift},c(),a.search().allowBus||a.search().allowMetro||a.search().allowTrain||a.search().brand&&a.search().passengerType&&a.search().timeBand||a.search().busTravelArea||a.search().operator||a.search().stationNames||a.search().brand?u(r.postJSON):a.url("").replace();"Swift PAYG"==a.search().brand&&(m(),p());function u(e){r.loadingStatus="loading",angular.copy(r.postJSON,r.postedJSON),a.search({allowBus:r.postedJSON.allowBus,allowTrain:r.postedJSON.allowTrain,allowMetro:r.postedJSON.allowMetro,passengerType:r.postedJSON.passengerType,timeBand:r.postedJSON.timeBand,busTravelArea:r.postedJSON.busTravelArea,operator:r.postedJSON.operator,brand:r.postedJSON.brand,stationNames:r.postedJSON.stationNames,limit:r.limit}),r.searchFilters={},console.log("this is posted"),console.log(r.postedJSON),n.ticketSearch(e).then(function(e){if(r.all=e,console.log("ticket search"),console.log(e),angular.forEach(r.all,function(t){-1==r.filterButtons.operator.indexOf(t.operator)&&r.filterButtons.operator.push(t.operator),-1==r.filterButtons.busTravelArea.indexOf(t.busTravelArea)&&r.filterButtons.busTravelArea.push(t.busTravelArea),-1==r.filterButtons.railZoneFrom.indexOf(t.railZoneFrom)&&r.filterButtons.railZoneFrom.push(t.railZoneFrom),-1==r.filterButtons.railZoneTo.indexOf(t.railZoneTo)&&r.filterButtons.railZoneTo.push(t.railZoneTo)}),a.search().stationNames){var o=a.search().stationNames,l=o.toString(),n=l.split(",");t.stationFromName=n[0],t.stationToName=n[1];var i=r.postedJSON.allowBus,s=r.postedJSON.allowTrain,c=r.postedJSON.allowMetro}(null!=i||null!=i&&null!=s||null!=i&&null!=c||null!=s&&null!=c)&&r.toggleFilter("mode"),null!=i&&null!=s&&null!=c&&r.toggleFilter("payment"),r.update(),r.loadingStatus="success"})}function d(){r.postJSON.allowBus=null,r.postJSON.allowTrain=null,r.postJSON.allowMetro=null}function p(){r.passValue=r.postJSON.brand,"Swift PAYG"==r.passValue?(r.isHideCheck=!r.isHideCheck,r.postJSON.passengerType=null,r.postJSON.timeBand=null,r.postJSON.stationNames=[]):"nbus"!=r.passValue&&"National Express"!=r.passValue&&"Diamond Bus"!=r.passValue&&"Stagecoach"!=r.passValue&&"Swift PAYG"!=r.passValue&&"West Midlands Metro"!=r.passValue||(r.postJSON.stationNames=[[]])}function m(){n.getSwiftSearch().then(function(t){r.swiftPaygTickets=t,console.log("swift search"),console.log(t)})}t.stationFromName=null,t.stationFromReq=!1,t.stationFrom=function(e){e?(t.stationFromName=e.originalObject.name,r.postJSON.stationNames[0]=e.originalObject.name,t.stationFromTitle=e.originalObject.name,t.stationFromNameZone=e.originalObject.zone,t.stationFromNameOoc=e.originalObject.outOfCounty,t.stationFromNameOocZ5=e.originalObject.zone5InCounty,t.stationToReq=!0,t.stationFromNameOocZ5&&(r.postJSON.brand="ntrain",r.postJSON.allowBus=null,r.postJSON.allowTrain=null,r.postJSON.allowMetro=null)):(t.stationFromName=null,r.postJSON.stationNames[0]=[[]],t.stationFromTitle=null)},t.stationToName=null,t.stationToReq=!1,t.stationTo=function(e){e?(t.stationToName=e.originalObject.name,r.postJSON.stationNames[1]=e.originalObject.name,t.stationToTitle=e.originalObject.name,t.stationToNameZone=e.originalObject.zone,t.stationToNameOoc=e.originalObject.outOfCounty,t.stationToNameOocZ5=e.originalObject.zone5InCounty,t.stationFromReq=!0,t.stationToNameOocZ5&&(r.postJSON.brand="ntrain",r.postJSON.allowBus=null,r.postJSON.allowTrain=null,r.postJSON.allowMetro=null)):(t.stationToName=null,r.postJSON.stationNames[1]=[[]],t.stationToTitle=null)},r.modalShownSwift=!1,t.date=new Date}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,e){return angular.forEach({},function(t,e){}),angular.forEach(t,function(t){}),[]}}]).filter("escapeFilter",[function(){return function(t){return t?String(t).replace(/\n/gm,"<br><br>"):""}}]).filter("replace",[function(){return function(t,e,o){if(void 0!==t){var a=new RegExp(e,"g");return t.replace(a,o)}}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",function(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(o,a,l){t(function(){o.$last&&e.ticketResults.refresh()},0)}}}]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams","$scope","$timeout",function(t,e,o,a,l,n){var i=this;i.loadingText="Loading...",i.loadingStatus="loading",i.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],i.loading=e(function(){i.loadingText=i.loadingArray[Math.round(Math.random()*(i.loadingArray.length-1))]},3500),i.ticketID=a.ticket,i.filterAccordions={},i.relatedTickets={},i.toggleClick=function(t){i.filterAccordions[t]=!i.filterAccordions[t]},i.modalShown=!1,i.toggleModal=function(){i.modalShown=!i.modalShown},i.toggleModalBus=function(){i.modalShownBus=!i.modalShownBus},i.toggleModalTrain=function(){i.modalShownTrain=!i.modalShownTrain},i.toggleModalSwift=function(){i.modalShownSwift=!i.modalShownSwift},i.operatorList=[],i.checkStations=function(){console.log("hello"+sessionStorage.getItem(savedData))},i.limit=4,s=i.ticketID,t.getTicket(s).then(function(e){i.all=e,console.log(e),i.all.relatedTickets.length&&angular.forEach(i.all.relatedTickets,function(e){t.getSimpleTicket(e.id).then(function(t){i.relatedTickets[e.id]=t})}),i.all.documents.length&&t.getTerms(s).then(function(t){i.relatedTerms=t}),t.getOperators().then(function(t){i.operatorList=t,console.log(t)}),i.backToSearch=o,console.log(i.backToSearch),l.stationFromNameZone="1"}),i.modalShownBus=!1,i.modalShownTrain=!1,i.modalShown=!1,i.modalShownSwift=!1,n(function(){i.loadingStatus="success"},2e3);var s}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",["$timeout","angularGridInstance",function(t,e){return{templateUrl:"partials/detail/related-product.html",restrict:"E",link:function(o,a,l){t(function(){o.$last&&e.alternativeResults.refresh()},0)}}}]).directive("operators",[function(){return{templateUrl:"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(t,e,o){t.dialogStyle={},o.width&&(t.dialogStyle.width=o.width),o.height&&(t.dialogStyle.height=o.height),o.modalclass&&(t.dialogStyle.class=o.modalclass),t.hideModal=function(){t.show=!1}},template:'<div ng-show="show"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="ng-modal-dialog boxin modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(t){var e=t.panes=[];t.select=function(t){angular.forEach(e,function(t){t.selected=!1}),t.selected=!0},this.addPane=function(o){0==e.length&&t.select(o),e.push(o)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(t,e,o,a){a.addPane(t)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}]).directive("tooltip",[function(){return{restrict:"A",controller:function(t,e){t.isShown=!1,this.showHover=function(){t.isShown=1!=t.isShown}},transclude:!0,link:function(t,e,o,a){t.copy=o.tooltipc,e.bind("click",function(){t.$apply(function(){a.showHover()})})},template:'<div ng-transclude></div><p class="field-help tooltip" ng-show="isShown"><span class="close modal__close"></span><span data-ng-bind-html="copy"></span></p>'}}])}();