!function(){"use strict";function t(t,e){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(r,i,l){t(function(){r.$last&&e.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(t,e,r,i,l,n,a){var o=this;function s(){o.all=[],o.filteredTickets=[],o.stationList=[],o.loadingStatus="",o.orderBy="TicketCurrentAmount",o.limit=parseInt(i.search().limit)||6,o.postJSON={AllowBus:i.search().AllowBus||null,AllowMetro:i.search().AllowMetro||null,AllowTrain:i.search().AllowTrain||null,PassengerType:i.search().PassengerType||"",TimeBand:i.search().TimeBand||"",Brand:i.search().Brand||null,StationNames:[]},o.clearModes=u,o.postedJSON={}}o.submit=c,o.clearFilter=function(){i.url("").replace(),s()},o.getStations=function(){n.getStations().then(function(t){o.stationList=t})},o.updateGrid=function(){e(function(){e(function(){o.filteredTickets.length&&(a.ticketResults.refresh(),l.set("url",i.url()))},82,!1)},82,!1)},o.update=function(){var t=o.all;console.log(o.searchFilters),angular.forEach(o.searchFilters,function(t,e){(-1!==e.indexOf("Allow")&&t||0==t&&-1===e.indexOf("Allow"))&&delete o.searchFilters[e]}),t=r("filter")(t,o.searchFilters),o.filteredTickets=r("orderBy")(t,o.orderBy),console.log(o.filteredTickets),console.log(o.searchFilters),o.updateGrid()},o.loadMore=function(){o.limit+=6,i.search("limit",o.limit),o.updateGrid()},o.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},o.toggleFilter=function(t){o.filterButtons[t]=!o.filterButtons[t]},s(),i.search().AllowBus||i.search().AllowMetro||i.search().AllowTrain||i.search().Brand&&i.search().PassengerType&&i.search().TimeBand||i.search().StationNames?c(o.postJSON):i.url("").replace();function c(t){o.loadingStatus="loading",angular.copy(o.postJSON,o.postedJSON),i.search({AllowBus:o.postedJSON.AllowBus,AllowTrain:o.postedJSON.AllowTrain,AllowMetro:o.postedJSON.AllowMetro,PassengerType:o.postedJSON.PassengerType,TimeBand:o.postedJSON.TimeBand,Brand:o.postedJSON.Brand,StationNames:[o.postJSON.StationNames],limit:o.limit}),o.searchFilters={},console.log("this is posted"),console.log(o.postedJSON),n.ticketSearch(t).then(function(t){o.all=t,angular.forEach(o.all,function(t){-1==o.filterButtons.Operator.indexOf(t.Operator)&&o.filterButtons.Operator.push(t.Operator),-1==o.filterButtons.BusTravelArea.indexOf(t.BusTravelArea)&&o.filterButtons.BusTravelArea.push(t.BusTravelArea),-1==o.filterButtons.RailZoneFrom.indexOf(t.RailZoneFrom)&&o.filterButtons.RailZoneFrom.push(t.RailZoneFrom),-1==o.filterButtons.RailZoneTo.indexOf(t.RailZoneTo)&&o.filterButtons.RailZoneTo.push(t.RailZoneTo)}),o.update(),o.loadingStatus="success"})}function u(){o.postJSON.AllowBus=null,o.postJSON.AllowTrain=null,o.postJSON.AllowMetro=null,o.postJSON.StationNames=null}t.travellingFrom=function(t){t&&(o.postJSON.StationNames[0]=t.originalObject.Name)},t.travellingTo=function(t){t&&(o.postJSON.StationNames[1]=t.originalObject.Name)}}]).filter("removeHTMLTags",[function(){return function(t){return t?String(t).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(e,r){return angular.forEach({},function(e,r){console.log(r,e),console.log(t[r])}),angular.forEach(e,function(t){}),[]}}]).filter("escapeFilter",[function(){return function(t){return t=t.replace(/\n/g,"<br><br>")}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",t]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(t,e,r,i){var l=this;l.loadingText="Loading...",l.loadingStatus="Loading",l.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],l.loading=e(function(){l.loadingText=l.loadingArray[Math.round(Math.random()*(l.loadingArray.length-1))]},3500),l.ticketID=i.ticket,l.filterAccordions={},l.relatedTickets={},l.toggleClick=function(t){l.filterAccordions[t]=!l.filterAccordions[t]},n=l.ticketID,t.getTicket(n).then(function(e){l.all=e,console.log(e),l.all.RelatedTickets.length?angular.forEach(l.all.RelatedTickets,function(e){t.getSimpleTicket(e.Id).then(function(t){l.relatedTickets[e.Id]=t,console.log(l.relatedTickets),l.loadingStatus="Success"})}):l.loadingStatus="Success",l.all.Documents.length?t.getTerms(n).then(function(t){l.relatedTerms=t,l.loadingStatus="Success"}):l.loadingStatus="Success",l.backToSearch=r,console.log(l.backToSearch)});var n}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",[function(){return{templateUrl:"partials/detail/related-product.html",restrict:"E"}}])}();