!function(){"use strict";function e(e,t){return{templateUrl:"partials/search-results/item.html",restrict:"E",link:function(l,i,n){e(function(){l.$last&&t.ticketResults.refresh()},0)}}}angular.module("ticketingApp.Controller",["angucomplete-alt"]).controller("TicketingSearchCtrl",["$scope","$timeout","$filter","$location","savedFilter","ticketingService","angularGridInstance",function(e,t,l,i,n,a,o){var r=this;function s(){r.all=[],r.filteredTickets=[],r.stationList=[],r.swiftPaygTickets=[],r.loadingStatus="",r.passValue="",r.orderBy="TicketCurrentAmount",r.limit=parseInt(i.search().limit)||6,i.search().StationNames?r.postJSON={AllowBus:i.search().AllowBus||null,AllowMetro:i.search().AllowMetro||null,AllowTrain:i.search().AllowTrain||null,PassengerType:i.search().PassengerType||"",TimeBand:i.search().TimeBand||"",Brand:i.search().Brand||null,StationNames:[i.search().StationNames||null]}:r.postJSON={AllowBus:i.search().AllowBus||null,AllowMetro:i.search().AllowMetro||null,AllowTrain:i.search().AllowTrain||null,PassengerType:i.search().PassengerType||"",TimeBand:i.search().TimeBand||"",Brand:i.search().Brand||null},r.clearModes=u,r.postedJSON={}}r.submit=c,r.clearFilter=function(){i.url("").replace(),s()},r.getStations=function(){a.getStations().then(function(e){r.stationList=e})},r.getSwiftPAYG=h,r.updateGrid=function(){t(function(){t(function(){r.filteredTickets.length&&(o.ticketResults.refresh(),n.set("url",i.url()))},82,!1)},82,!1)},r.update=function(){var e=r.all;console.log(r.searchFilters),angular.forEach(r.searchFilters,function(e,t){(-1!==t.indexOf("Allow")&&e||0==e&&-1===t.indexOf("Allow"))&&delete r.searchFilters[t]}),e=l("filter")(e,r.searchFilters),r.filteredTickets=l("orderBy")(e,r.orderBy),console.log(r.filteredTickets),console.log(r.searchFilters),r.updateGrid()},r.loadMore=function(){r.limit+=6,i.search("limit",r.limit),r.updateGrid()},r.filterButtons={Operator:[],OperatorLength:0,BusTravelArea:[],RailZoneFrom:[],RailZoneTo:[]},r.toggleFilter=function(e){r.filterButtons[e]=!r.filterButtons[e]},r.swiftPAYG=d,r.ntrainOOC=function(){r.passValue=r.postJSON.Brand,"ntrain - Out of County"==r.passValue&&(r.postedJSON.AllowTrain=!0,r.postJSON.StationNames=["Rugeley Trent Valley"])},s(),void 0===i.search().StationNames&&console.log("no stations");i.search().AllowBus||i.search().AllowMetro||i.search().AllowTrain||i.search().Brand&&i.search().PassengerType&&i.search().TimeBand||i.search().StationNames?c(r.postJSON):i.url("").replace();"Swift PAYG"==i.search().Brand&&(h(),d());function c(e){r.loadingStatus="loading",angular.copy(r.postJSON,r.postedJSON),i.search({AllowBus:r.postedJSON.AllowBus,AllowTrain:r.postedJSON.AllowTrain,AllowMetro:r.postedJSON.AllowMetro,PassengerType:r.postedJSON.PassengerType,TimeBand:r.postedJSON.TimeBand,Brand:r.postedJSON.Brand,StationNames:[r.postJSON.StationNames],limit:r.limit}),r.searchFilters={},console.log("this is posted"),console.log(r.postedJSON),a.ticketSearch(e).then(function(e){r.all=e,console.log("ticket search"),console.log(e),angular.forEach(r.all,function(e){-1==r.filterButtons.Operator.indexOf(e.Operator)&&r.filterButtons.Operator.push(e.Operator),-1==r.filterButtons.BusTravelArea.indexOf(e.BusTravelArea)&&r.filterButtons.BusTravelArea.push(e.BusTravelArea),-1==r.filterButtons.RailZoneFrom.indexOf(e.RailZoneFrom)&&r.filterButtons.RailZoneFrom.push(e.RailZoneFrom),-1==r.filterButtons.RailZoneTo.indexOf(e.RailZoneTo)&&r.filterButtons.RailZoneTo.push(e.RailZoneTo)}),r.update(),r.loadingStatus="success"})}function u(){r.postJSON.AllowBus=null,r.postJSON.AllowTrain=null,r.postJSON.AllowMetro=null,r.postJSON.StationNames=null}function d(){r.passValue=r.postJSON.Brand,"Swift PAYG"==r.passValue&&(r.isHideCheck=!r.isHideCheck,r.postJSON.PassengerType=null,r.postJSON.TimeBand=null,r.postJSON.StationNames=null)}function h(){a.getSwiftSearch().then(function(e){r.swiftPaygTickets=e,console.log("swift search"),console.log(e)})}e.stationFrom=function(e){e&&(console.log(e),r.postJSON.StationNames[0]=e.originalObject.Name,r.train="yes")},e.stationTo=function(e){e&&(console.log(e),r.postJSON.StationNames[1]=e.originalObject.Name)}}]).filter("removeHTMLTags",[function(){return function(e){return e?String(e).replace(/<[^>]+>/gm,""):""}}]).filter("modeFilter",[function(){return function(t,l){return angular.forEach({},function(t,l){console.log(l,t),console.log(e[l])}),angular.forEach(t,function(e){}),[]}}]).filter("escapeFilter",[function(){return function(e){return e?String(e).replace(/\n/gm,"<br><br>"):""}}]).directive("initialSearch",[function(){return{templateUrl:"partials/search-results/initial-search.html",restrict:"E"}}]).directive("searchResults",[function(){return{templateUrl:"partials/search-results/search-results.html",restrict:"E"}}]).directive("filters",[function(){return{templateUrl:"partials/search-results/filters.html",restrict:"E"}}]).directive("item",["$timeout","angularGridInstance",e]).controller("TicketDetailCtrl",["ticketingService","$interval","getURL","$routeParams",function(e,t,l,i){var n=this;n.loadingText="Loading...",n.loadingStatus="Loading",n.loadingArray=["Well, what are you waiting for?","Are we there yet?","Warming up the processors...","Reconfiguring the office coffee machine...","Doing something useful...","Are you ready?","So, do you come here often?","This may take some time...","I know this is painful to watch, but I have to load this.","Oh, no! Loading time...","Still Waiting... huh","Waiting for something in the server.","Creating randomly generated feature.","It's not you. It's me.","Eating your internet cookies...Yummy!"],n.loading=t(function(){n.loadingText=n.loadingArray[Math.round(Math.random()*(n.loadingArray.length-1))]},3500),n.ticketID=i.ticket,n.filterAccordions={},n.relatedTickets={},n.toggleClick=function(e){n.filterAccordions[e]=!n.filterAccordions[e]},n.modalShown=!1,n.toggleModal=function(){n.modalShown=!n.modalShown},n.operatorList=[],n.limit=4,a=n.ticketID,e.getTicket(a).then(function(t){n.all=t,console.log(t),n.all.RelatedTickets.length?angular.forEach(n.all.RelatedTickets,function(t){e.getSimpleTicket(t.Id).then(function(e){n.relatedTickets[t.Id]=e,console.log(n.relatedTickets[t.Id]),n.loadingStatus="Success"})}):n.loadingStatus="Success",n.all.Documents.length?e.getTerms(a).then(function(e){n.relatedTerms=e,n.loadingStatus="Success"}):n.loadingStatus="Success",e.getOperators().then(function(e){n.operatorList=e,console.log(e),n.loadingStatus="Success"}),n.backToSearch=l,console.log(n.backToSearch)});var a}]).directive("detailDetails",[function(){return{templateUrl:"partials/detail/details.html",restrict:"E"}}]).directive("detailSidebar",[function(){return{templateUrl:"partials/detail/sidebar.html",restrict:"E"}}]).directive("detailAlternative",[function(){return{templateUrl:"partials/detail/alternative.html",restrict:"E"}}]).directive("detailRelated",["$timeout","angularGridInstance",function(e,t){return{templateUrl:"partials/detail/related-product.html",restrict:"E",link:function(l,i,n){e(function(){l.$last&&t.alternativeResults.refresh()},0)}}}]).directive("operators",[function(){return{templateUrl:"partials/detail/operator.html",restrict:"E"}}]).directive("modalDialog",[function(){return{restrict:"E",scope:{show:"="},replace:!0,transclude:!0,link:function(e,t,l){e.dialogStyle={},l.width&&(e.dialogStyle.width=l.width),l.height&&(e.dialogStyle.height=l.height),l.class&&(e.dialogStyle.class=l.class),e.hideModal=function(){e.show=!1}},template:'<div ng-show="show"><div ng-show="show" class="modal" ng-click="hideModal()"></div><div class="ng-modal-dialog boxin modal-content {{dialogStyle.class}}" ng-style="dialogStyle"><div class="ng-modal-close modal__close js-modal-close" ng-click="hideModal()">X</div><div class="ng-modal-dialog-content" ng-transclude></div></div></div>'}}]).directive("tabs",[function(){return{restrict:"E",transclude:!0,scope:{},controller:["$scope",function(e){var t=e.panes=[];e.select=function(e){angular.forEach(t,function(e){e.selected=!1}),e.selected=!0},this.addPane=function(l){0==t.length&&e.select(l),t.push(l)}}],template:'<div class="cfx"><div class="arrdep-filters__toggle"><div class="radio-bar"><span ng-repeat="pane in panes" ng-class="{active:pane.selected}"><input name="option" id="{{pane.title}}" type="radio"><label ng-click="select(pane)" for="{{pane.title}}" style="height: 44px;">{{pane.title}}</label></span></div></div><div class="tab-content" ng-transclude></div></div>',replace:!0}}]).directive("pane",[function(){return{require:"^tabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(e,t,l,i){i.addPane(e)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}]).directive("tooltip",[function(){return{restrict:"A",controller:function(e,t){e.isShown=!1,this.showHover=function(){e.isShown=1!=e.isShown}},transclude:!0,link:function(e,t,l,i){t.bind("click",function(){e.$apply(function(){i.showHover()})})},template:'<div ng-transclude></div><p class="tooltipPopup" ng-class="field-help tooltip" ng-show="isShown"><span>I am the Hover Popup</span></p>'}}])}();